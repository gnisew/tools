<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·šä¸Šæ–‡å­—ç·¨è¼¯å™¨</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="ime.css">
	<link href="https://tauhu.tw/tauhu-oo.css" rel="stylesheet">
	<link href="https://tauhu.tw/tauhu-mootng.css" rel="stylesheet">
	<link href="https://oikasu1.github.io/kasuexam/kasu/fonts/twhei.css" rel="stylesheet">
	<link rel="stylesheet" href="https://oikasu1.github.io/fonts/twfonts.css">

    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            background: #f3f2f1;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
		.main-controls-container {
			display: flex;
			flex-wrap: wrap; /* æ ¸å¿ƒå±¬æ€§ï¼šå…è¨±å…§å®¹åœ¨ç©ºé–“ä¸è¶³æ™‚æ›è¡Œ */
			align-items: center; /* è®“ä¸åŒé«˜åº¦çš„å…ƒä»¶åœ¨å‚ç›´æ–¹å‘ä¸Šç½®ä¸­å°é½Š */
			background: #ffffff;
			border-bottom: 1px solid #d1d1d1;
			padding: 0 8px; /* ç‚ºå®¹å™¨å¢åŠ å·¦å³å…§é‚Šè· */
			gap: 8px; /* åœ¨é¸å–®åˆ—èˆ‡å·¥å…·åˆ—ä¹‹é–“å¢åŠ ä¸€äº›é–“è· */
		}
		.header {
			background: #ffffff;
			border-bottom: none; /* ç§»é™¤åŸå§‹çš„åº•éƒ¨é‚Šç·š */
			padding: 8px 16px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			box-shadow: none; /* ç§»é™¤åŸå§‹çš„é™°å½± */
			flex-shrink: 0; /* é˜²æ­¢é¸å–®åˆ—åœ¨ç©ºé–“ä¸è¶³æ™‚è¢«éåº¦å£“ç¸® */
		}

        .header-content {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
            overflow: hidden;
        }

        .menu-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            overflow: hidden;
            padding: 0 8px;
            flex: 1;
            position: relative;
        }

        .menu-toggle-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #323130;
            transition: background 0.2s;
            flex-shrink: 0;
            margin-right: 8px;
        }

        .menu-toggle-btn:hover {
            background: #f3f2f1;
        }

        .menu-items {
            display: flex;
            align-items: center;
            gap: 8px;
            overflow: hidden;
            flex: 1;
        }

        .more-menu {
            position: relative;
        }

        .more-btn {
            padding: 12px 8px;
            cursor: pointer;
            color: #323130;
            font-size: 14px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
            background: none;
            border: none;
            display: none;
        }

        .more-btn:hover {
            background: #f3f2f1;
            border-bottom-color: #0078d4;
        }

        .more-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 120px;
            display: none;
        }

        .more-dropdown .menu-item {
            display: block;
            padding: 12px 16px;
            border-bottom: none;
            border-radius: 0;
        }

        .more-dropdown .menu-item:hover {
            background: #f3f2f1;
        }

        @media (max-width: 1024px) {
            .menu-bar {
                width: 100%;
            }
        }

        .menu-item {
            padding: 12px 8px;
            cursor: pointer;
            color: #323130;
            font-size: 14px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .menu-item:hover {
            background: #f3f2f1;
            border-bottom-color: #0078d4;
        }

        .menu-item.active {
            border-bottom-color: #0078d4;
            color: #0078d4;
        }

		.toolbar {
			background: #ffffff;
			border-bottom: none; /* ç§»é™¤åŸå§‹çš„åº•éƒ¨é‚Šç·š */
			padding: 8px 16px;
			display: flex;
			align-items: center;
			gap: 4px;
			flex-wrap: wrap;
			flex-grow: 1; /* å…è¨±å·¥å…·åˆ—ä½”æ“šå‰©é¤˜çš„ç©ºé–“ */
		}

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 4px;
            padding-right: 12px;
            border-right: 1px solid #d1d1d1;
            margin-right: 8px;
        }

        .toolbar-group:last-child {
            border-right: none;
            margin-right: 0;
        }

        .toolbar-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #323130;
            transition: background 0.2s;
        }

        .toolbar-btn:hover {
            background: #f3f2f1;
        }

        .toolbar-btn.active {
            background: #deecf9;
            color: #0078d4;
        }

        .font-select, .size-select {
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .font-select {
            width: 120px;
        }

        .size-select {
            width: 60px;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

		.editor-container {
			flex: 1;
			padding-top: 20px;
			padding-bottom: 20px;
			display: flex;
			justify-content: center;
			overflow: auto;
		}

        .editor {
            width: 100%;
            max-width: 800px;
            height: calc(100vh - 240px);
            background: white;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            padding: 40px 20px;
            font-size: 18px;
            line-height: 1.6;
            font-family: "å°ç£é»‘é«”", 'tauhu-oo', serif;
            outline: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            resize: none;
        }

        .status-bar {
            background: #ffffff;
            border-top: 1px solid #d1d1d1;
            padding: 8px 16px;
            font-size: 12px;
            color: #605e5c;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            min-width: 300px;
        }

        .modal-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #323130;
        }

        .modal-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 16px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            background: white;
            display: flex;
            align-items: center;
        }

        .btn-primary {
            background: #0078d4;
            color: white;
            border-color: #0078d4;
        }

        .btn-primary:hover {
            background: #106ebe;
        }

        .btn:hover {
            background: #f3f2f1;
        }

        .find-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border: 1px solid #d1d1d1;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 350px;
            user-select: none;
        }

        .find-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #d1d1d1;
            border-radius: 8px 8px 0 0;
            cursor: move;
        }

        .drag-handle {
            color: #666;
            font-size: 18px;
        }

        .close-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            color: #666;
        }

        .close-btn:hover {
            background: #e9ecef;
        }

        .find-panel-content {
            padding: 16px;
        }

        .find-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .find-row label {
            width: 40px;
            font-size: 14px;
            color: #323130;
        }

        .find-row input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            font-size: 14px;
        }

        .find-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #d1d1d1;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .find-btn:hover {
            background: #f3f2f1;
        }

        .find-options {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 8px;
            font-size: 13px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            margin: 0;
        }



        .highlight {
            background-color: #ffeb3b;
            color: #000;
        }

        .current-match {
            background-color: #ff9800;
            color: #fff;
        }



        .editor-wrapper {
            position: relative;
            width: 100%;
            max-width: 800px;
			padding-left: 20px;
			padding-right: 20px;
        }

        .selection-highlight {
            background-color: rgba(0, 120, 212, 0.2);
            border: 1px solid #0078d4;
            position: absolute;
            pointer-events: none;
            z-index: 5;
        }

        .toolbar-btn-text {
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0 8px;
            font-size: 14px;
            color: #323130;
            transition: background 0.2s;
        }

        .toolbar-btn-text:hover {
            background: #f3f2f1;
        }

        .toolbar-btn-text.active {
            background: #deecf9;
            color: #0078d4;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle {
            position: relative;
        }

        .dropdown-arrow {
            font-size: 16px !important;
            margin-left: 4px;
            transition: transform 0.2s;
        }

        .dropdown-toggle.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 180px;
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .dropdown-menu.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #323130;
            border-bottom: 1px solid #f3f2f1;
            transition: background 0.2s;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f3f2f1;
        }

        .dropdown-item:first-child {
            border-radius: 4px 4px 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 4px 4px;
        }

        .dictionary-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            border-left: 1px solid #d1d1d1;
            box-shadow: -2px 0 8px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .dictionary-sidebar.open {
            right: 0;
        }



        .dictionary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #d1d1d1;
            background: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .dictionary-title {
            font-size: 18px;
            font-weight: 600;
            color: #323130;
        }

        .dictionary-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            color: #666;
        }

        .dictionary-close:hover {
            background: #e9ecef;
        }

        .dictionary-content {
            padding: 20px;
        }

        .dictionary-search {
            margin-bottom: 20px;
        }

        .search-input-group {
            display: flex;
            gap: 8px;
        }

        .search-input-group input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            font-size: 14px;
        }

        .search-btn {
            width: 44px;
            height: 44px;
            border: 1px solid #d1d1d1;
            background: #0078d4;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .search-btn:hover {
            background: #106ebe;
        }

        .dictionary-results {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .dictionary-entry {
            padding: 16px;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            margin-bottom: 12px;
            background: #fafafa;
        }

        .dictionary-word {
            font-size: 18px;
            font-weight: 600;
            color: #323130;
            margin-bottom: 8px;
        }

        .dictionary-pronunciation {
            font-size: 14px;
            color: #0078d4;
            font-family: monospace;
            margin-bottom: 8px;
        }

        .dictionary-definition {
            font-size: 14px;
            color: #605e5c;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .dictionary-example {
            font-size: 13px;
            color: #666;
            font-style: italic;
            padding: 8px 12px;
            background: #f3f2f1;
            border-radius: 4px;
            border-left: 3px solid #0078d4;
        }

        .dictionary-placeholder {
            text-align: center;
            padding: 40px 20px;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -350px;
            width: 350px;
            height: 100vh;
            background: white;
            border-right: 1px solid #d1d1d1;
            box-shadow: 2px 0 8px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .sidebar-overlay.show {
            display: block;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #d1d1d1;
            background: #f8f9fa;
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            color: #323130;
        }

        .sidebar-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            color: #666;
        }

        .sidebar-close:hover {
            background: #e9ecef;
        }

        .sidebar-content {
            padding: 20px;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #323130;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }

        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .settings-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            min-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .settings-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #323130;
        }

        .settings-section {
            margin-bottom: 20px;
        }

        .settings-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #323130;
        }

        @media (max-width: 768px) {
            .toolbar {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .editor {
                padding: 20px;
                font-size: 16px;
            }
            
            .menu-bar {
                padding: 0 8px;
                gap: 12px;
            }
            
            .toolbar {
                padding: 8px;
            }

            .find-panel {
                right: 10px;
                left: 10px;
                min-width: auto;
				width: auto;
            }
            .find-row input {
                min-width: 0;
            }
            .toolbar-btn-text .btn-text {
                display: none;
            }

            .settings-content {
                min-width: 300px;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="main-controls-container">
    <div class="header">
        <div class="header-content">
            <div class="menu-bar">
                <button class="menu-toggle-btn" onclick="toggleSidebar()" title="é¸å–®">
                    <span class="material-icons">menu</span>
                </button>
                <div class="menu-items" id="menuItems">
                    <div class="menu-item active" onclick="switchTab('home')">ğŸ¥·çƒè¡£è¡Œ</div>
					<!--
                    <div class="menu-item" onclick="switchTab('sixian')" id="menu-sixian">å››ç¸£</div>
                    <div class="menu-item" onclick="switchTab('hailu')" id="menu-hailu">æµ·é™¸</div>
                    <div class="menu-item" onclick="switchTab('dabu')" id="menu-dabu">å¤§åŸ”</div>
                    <div class="menu-item" onclick="switchTab('raoping')" id="menu-raoping">é¥’å¹³</div>
                    <div class="menu-item" onclick="switchTab('zhaoan')" id="menu-zhaoan">è©”å®‰</div>
                    <div class="menu-item" onclick="switchTab('hele')" id="menu-hele">å’Œæ¨‚</div>
                    <div class="menu-item" onclick="switchTab('matsu')" id="menu-matsu">é¦¬ç¥–</div>
					-->
                </div>
                <div class="more-menu">
                    <button class="more-btn" id="moreBtn" onclick="toggleMoreMenu()">
                        æ›´å¤š <span class="material-icons" style="font-size: 16px;">expand_more</span>
                    </button>
                    <div class="more-dropdown" id="moreDropdown"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="toolbar" id="homeToolbar">
        <div class="toolbar-group">
            <button class="toolbar-btn" id="autoSaveBtn" onclick="toggleAutoSave()" title="è‡ªå‹•å„²å­˜"><span class="material-icons">cloud_sync</span></button>

        </div>
		<div class="toolbar-group">
			<button class="toolbar-btn-text ime-toggle-button" title="è¼¸å…¥æ³•">
				<span class="material-icons">keyboard</span>
				<span class="btn-text">è¼¸å…¥æ³•</span>
			</button>
			
		</div>
        <div class="toolbar-group">
            <button class="toolbar-btn" onclick="copyText()" title="è¤‡è£½"><span class="material-icons">content_copy</span></button>
            <button class="toolbar-btn" onclick="cutText()" title="å‰ªä¸‹"><span class="material-icons">content_cut</span></button>
            <button class="toolbar-btn" onclick="selectAll()" title="å…¨é¸"><span class="material-icons">select_all</span></button>
            <button class="toolbar-btn" onclick="findReplace()" title="å°‹æ‰¾èˆ‡å–ä»£"><span class="material-icons">search</span></button>
        </div>
        
        <div class="toolbar-group">
            <select class="size-select" id="fontSize" onchange="changeFontSize()">
                <option value="12">12</option>
                <option value="14">14</option>
                <option value="16">16</option>
                <option value="18" selected>18</option>
                <option value="20">20</option>
                <option value="24">24</option>
				<option value="32">32</option>
            </select>
            <select class="font-select" id="fontFamily" onchange="changeFontFamily()">
			    <option value="'twhei-s', 'TWHEI', 'å°ç£é»‘é«”'">é»‘é«”</option>
			    <option value="tauhu-oo">è±†è…é»‘é«”</option>
			    <option value="å°ç£æ¥·é«”">å°ç£æ¥·é«”</option>
				<option value="å°ç£å®‹é«”">å°ç£å®‹é«”</option>
				<option value="TaigiKaiStd-TL-R">å­—å’æ¨™æ¥·</option>	
				<option value="TaigiGenSekiG-TL-R">å­—å’é»‘é«”</option>	
				<option value="TaigiKaiStd-TLHI-R">å­—å’å°ç¾…æ–¹éŸ³</option>
				<option value="EngTRESSA">EngTRESS-A</option>
				<option value="EngTRESSB">EngTRESS-B</option>


            </select>
        </div>
    </div>






    <div class="toolbar" id="sixianToolbar" style="display: none;">
        <div class="toolbar-group">
            <button class="toolbar-btn-text ime-toggle-button" title="è¼¸å…¥æ³•">
                <span class="material-icons">keyboard</span>
                <span class="btn-text">è¼¸å…¥æ³•</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToHakka('sixian')" title="è¯è½‰å®¢">
                <span class="material-icons">language</span>
                <span class="btn-text">è¯è½‰å®¢</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToMandarin('sixian')" title="å®¢è½‰è¯">
                <span class="material-icons">language</span>
                <span class="btn-text">å®¢è½‰è¯</span>
            </button>
            <button class="toolbar-btn-text" onclick="toPinyin('sixian')" title="è½‰æ‹¼éŸ³">
                <span class="material-icons">translate</span>
                <span class="btn-text">è½‰æ‹¼éŸ³</span>
            </button>
            <div class="dropdown">
                <button class="toolbar-btn-text dropdown-toggle" onclick="togglePinyinDropdown('sixian')" title="æ‹¼éŸ³è½‰æ›">
                    <span class="material-icons">text_rotation_none</span>
                    <span class="btn-text">æ‹¼éŸ³è½‰æ›</span>
                    <span class="material-icons dropdown-arrow">expand_more</span>
                </button>
                <div class="dropdown-menu" id="pinyinDropdown-sixian">
                    <div class="dropdown-item" onclick="convertPinyin('sixian', 'number-to-tone')">æ•¸å­—èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('sixian', 'tone-to-number')">å­—å°¾èª¿è½‰æ•¸å­—èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('sixian', 'letter-to-tone')">å­—æ¯èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('sixian', 'tone-to-letter')">å­—å°¾èª¿è½‰å­—æ¯èª¿</div>
                </div>
            </div>
            <button class="toolbar-btn-text" onclick="searchDictionary('sixian')" title="æŸ¥è¾­å…¸">
                <span class="material-icons">book</span>
                <span class="btn-text">æŸ¥è¾­å…¸</span>
            </button>
        </div>
    </div>

    <div class="toolbar" id="hailuToolbar" style="display: none;">
        <div class="toolbar-group">
            <button class="toolbar-btn-text ime-toggle-button" title="è¼¸å…¥æ³•">
                <span class="material-icons">keyboard</span>
                <span class="btn-text">è¼¸å…¥æ³•</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToHakka('hailu')" title="è¯è½‰å®¢">
                <span class="material-icons">language</span>
                <span class="btn-text">è¯è½‰å®¢</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToMandarin('hailu')" title="å®¢è½‰è¯">
                <span class="material-icons">language</span>
                <span class="btn-text">å®¢è½‰è¯</span>
            </button>
            <button class="toolbar-btn-text" onclick="toPinyin('hailu')" title="è½‰æ‹¼éŸ³">
                <span class="material-icons">translate</span>
                <span class="btn-text">è½‰æ‹¼éŸ³</span>
            </button>
            <div class="dropdown">
                <button class="toolbar-btn-text dropdown-toggle" onclick="togglePinyinDropdown('hailu')" title="æ‹¼éŸ³è½‰æ›">
                    <span class="material-icons">text_rotation_none</span>
                    <span class="btn-text">æ‹¼éŸ³è½‰æ›</span>
                    <span class="material-icons dropdown-arrow">expand_more</span>
                </button>
                <div class="dropdown-menu" id="pinyinDropdown-hailu">
                    <div class="dropdown-item" onclick="convertPinyin('hailu', 'number-to-tone')">æ•¸å­—èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('hailu', 'tone-to-number')">å­—å°¾èª¿è½‰æ•¸å­—èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('hailu', 'letter-to-tone')">å­—æ¯èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('hailu', 'tone-to-letter')">å­—å°¾èª¿è½‰å­—æ¯èª¿</div>
                </div>
            </div>
            <button class="toolbar-btn-text" onclick="searchDictionary('hailu')" title="æŸ¥è¾­å…¸">
                <span class="material-icons">book</span>
                <span class="btn-text">æŸ¥è¾­å…¸</span>
            </button>
        </div>
    </div>

    <div class="toolbar" id="dabuToolbar" style="display: none;">
        <div class="toolbar-group">
            <button class="toolbar-btn-text ime-toggle-button" title="è¼¸å…¥æ³•">
                <span class="material-icons">keyboard</span>
                <span class="btn-text">è¼¸å…¥æ³•</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToHakka('dabu')" title="è¯è½‰å®¢">
                <span class="material-icons">language</span>
                <span class="btn-text">è¯è½‰å®¢</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToMandarin('dabu')" title="å®¢è½‰è¯">
                <span class="material-icons">language</span>
                <span class="btn-text">å®¢è½‰è¯</span>
            </button>
            <button class="toolbar-btn-text" onclick="toPinyin('dabu')" title="è½‰æ‹¼éŸ³">
                <span class="material-icons">translate</span>
                <span class="btn-text">è½‰æ‹¼éŸ³</span>
            </button>
            <div class="dropdown">
                <button class="toolbar-btn-text dropdown-toggle" onclick="togglePinyinDropdown('dabu')" title="æ‹¼éŸ³è½‰æ›">
                    <span class="material-icons">text_rotation_none</span>
                    <span class="btn-text">æ‹¼éŸ³è½‰æ›</span>
                    <span class="material-icons dropdown-arrow">expand_more</span>
                </button>
                <div class="dropdown-menu" id="pinyinDropdown-dabu">
                    <div class="dropdown-item" onclick="convertPinyin('dabu', 'number-to-tone')">æ•¸å­—èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('dabu', 'tone-to-number')">å­—å°¾èª¿è½‰æ•¸å­—èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('dabu', 'letter-to-tone')">å­—æ¯èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('dabu', 'tone-to-letter')">å­—å°¾èª¿è½‰å­—æ¯èª¿</div>
                </div>
            </div>
            <button class="toolbar-btn-text" onclick="searchDictionary('dabu')" title="æŸ¥è¾­å…¸">
                <span class="material-icons">book</span>
                <span class="btn-text">æŸ¥è¾­å…¸</span>
            </button>
        </div>
    </div>

    <div class="toolbar" id="raopingToolbar" style="display: none;">
        <div class="toolbar-group">
            <button class="toolbar-btn-text ime-toggle-button" title="è¼¸å…¥æ³•">
                <span class="material-icons">keyboard</span>
                <span class="btn-text">è¼¸å…¥æ³•</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToHakka('raoping')" title="è¯è½‰å®¢">
                <span class="material-icons">language</span>
                <span class="btn-text">è¯è½‰å®¢</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToMandarin('raoping')" title="å®¢è½‰è¯">
                <span class="material-icons">language</span>
                <span class="btn-text">å®¢è½‰è¯</span>
            </button>
            <button class="toolbar-btn-text" onclick="toPinyin('raoping')" title="è½‰æ‹¼éŸ³">
                <span class="material-icons">translate</span>
                <span class="btn-text">è½‰æ‹¼éŸ³</span>
            </button>
            <div class="dropdown">
                <button class="toolbar-btn-text dropdown-toggle" onclick="togglePinyinDropdown('raoping')" title="æ‹¼éŸ³è½‰æ›">
                    <span class="material-icons">text_rotation_none</span>
                    <span class="btn-text">æ‹¼éŸ³è½‰æ›</span>
                    <span class="material-icons dropdown-arrow">expand_more</span>
                </button>
                <div class="dropdown-menu" id="pinyinDropdown-raoping">
                    <div class="dropdown-item" onclick="convertPinyin('raoping', 'number-to-tone')">æ•¸å­—èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('raoping', 'tone-to-number')">å­—å°¾èª¿è½‰æ•¸å­—èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('raoping', 'letter-to-tone')">å­—æ¯èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('raoping', 'tone-to-letter')">å­—å°¾èª¿è½‰å­—æ¯èª¿</div>
                </div>
            </div>
            <button class="toolbar-btn-text" onclick="searchDictionary('raoping')" title="æŸ¥è¾­å…¸">
                <span class="material-icons">book</span>
                <span class="btn-text">æŸ¥è¾­å…¸</span>
            </button>
        </div>
    </div>

    <div class="toolbar" id="zhaoanToolbar" style="display: none;">
        <div class="toolbar-group">
            <button class="toolbar-btn-text ime-toggle-button" title="è¼¸å…¥æ³•">
                <span class="material-icons">keyboard</span>
                <span class="btn-text">è¼¸å…¥æ³•</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToHakka('zhaoan')" title="è¯è½‰å®¢">
                <span class="material-icons">language</span>
                <span class="btn-text">è¯è½‰å®¢</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToMandarin('zhaoan')" title="å®¢è½‰è¯">
                <span class="material-icons">language</span>
                <span class="btn-text">å®¢è½‰è¯</span>
            </button>
            <button class="toolbar-btn-text" onclick="toPinyin('zhaoan')" title="è½‰æ‹¼éŸ³">
                <span class="material-icons">translate</span>
                <span class="btn-text">è½‰æ‹¼éŸ³</span>
            </button>
            <div class="dropdown">
                <button class="toolbar-btn-text dropdown-toggle" onclick="togglePinyinDropdown('zhaoan')" title="æ‹¼éŸ³è½‰æ›">
                    <span class="material-icons">text_rotation_none</span>
                    <span class="btn-text">æ‹¼éŸ³è½‰æ›</span>
                    <span class="material-icons dropdown-arrow">expand_more</span>
                </button>
                <div class="dropdown-menu" id="pinyinDropdown-zhaoan">
                    <div class="dropdown-item" onclick="convertPinyin('zhaoan', 'number-to-tone')">æ•¸å­—èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('zhaoan', 'tone-to-number')">å­—å°¾èª¿è½‰æ•¸å­—èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('zhaoan', 'letter-to-tone')">å­—æ¯èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('zhaoan', 'tone-to-letter')">å­—å°¾èª¿è½‰å­—æ¯èª¿</div>
                </div>
            </div>
            <button class="toolbar-btn-text" onclick="searchDictionary('zhaoan')" title="æŸ¥è¾­å…¸">
                <span class="material-icons">book</span>
                <span class="btn-text">æŸ¥è¾­å…¸</span>
            </button>
        </div>
    </div>

    <div class="toolbar" id="heleToolbar" style="display: none;">
        <div class="toolbar-group">
            <button class="toolbar-btn-text ime-toggle-button" title="è¼¸å…¥æ³•">
                <span class="material-icons">keyboard</span>
                <span class="btn-text">è¼¸å…¥æ³•</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToTaiwanese('hele')" title="è¯ç¿»å°">
                <span class="material-icons">language</span>
                <span class="btn-text">è¯ç¿»å°</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToMandarin('hele')" title="å°è½‰è¯">
                <span class="material-icons">language</span>
                <span class="btn-text">å°è½‰è¯</span>
            </button>
            <button class="toolbar-btn-text" onclick="toPinyin('hele')" title="è½‰æ‹¼éŸ³">
                <span class="material-icons">translate</span>
                <span class="btn-text">è½‰æ‹¼éŸ³</span>
            </button>
            <div class="dropdown">
                <button class="toolbar-btn-text dropdown-toggle" onclick="togglePinyinDropdown('hele')" title="æ‹¼éŸ³è½‰æ›">
                    <span class="material-icons">text_rotation_none</span>
                    <span class="btn-text">æ‹¼éŸ³è½‰æ›</span>
                    <span class="material-icons dropdown-arrow">expand_more</span>
                </button>
                <div class="dropdown-menu" id="pinyinDropdown-hele">
                    <div class="dropdown-item" onclick="convertPinyin('hele', 'number-to-tone')">æ•¸å­—èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('hele', 'tone-to-number')">å­—å°¾èª¿è½‰æ•¸å­—èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('hele', 'letter-to-tone')">å­—æ¯èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('hele', 'tone-to-letter')">å­—å°¾èª¿è½‰å­—æ¯èª¿</div>
                </div>
            </div>
            <button class="toolbar-btn-text" onclick="searchDictionary('hele')" title="æŸ¥è¾­å…¸">
                <span class="material-icons">book</span>
                <span class="btn-text">æŸ¥è¾­å…¸</span>
            </button>
        </div>
    </div>

    <div class="toolbar" id="matsuToolbar" style="display: none;">
        <div class="toolbar-group">
            <button class="toolbar-btn-text ime-toggle-button" title="è¼¸å…¥æ³•">
                <span class="material-icons">keyboard</span>
                <span class="btn-text">è¼¸å…¥æ³•</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToFuzhou('matsu')" title="è¯ç¿»ç¦">
                <span class="material-icons">language</span>
                <span class="btn-text">è¯ç¿»ç¦</span>
            </button>
            <button class="toolbar-btn-text" onclick="translateToMandarin('matsu')" title="ç¦è½‰è¯">
                <span class="material-icons">language</span>
                <span class="btn-text">ç¦è½‰è¯</span>
            </button>
            <button class="toolbar-btn-text" onclick="toPinyin('matsu')" title="è½‰æ‹¼éŸ³">
                <span class="material-icons">translate</span>
                <span class="btn-text">è½‰æ‹¼éŸ³</span>
            </button>
            <div class="dropdown">
                <button class="toolbar-btn-text dropdown-toggle" onclick="togglePinyinDropdown('matsu')" title="æ‹¼éŸ³è½‰æ›">
                    <span class="material-icons">text_rotation_none</span>
                    <span class="btn-text">æ‹¼éŸ³è½‰æ›</span>
                    <span class="material-icons dropdown-arrow">expand_more</span>
                </button>
                <div class="dropdown-menu" id="pinyinDropdown-matsu">
                    <div class="dropdown-item" onclick="convertPinyin('matsu', 'number-to-tone')">æ•¸å­—èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('matsu', 'tone-to-number')">å­—å°¾èª¿è½‰æ•¸å­—èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('matsu', 'letter-to-tone')">å­—æ¯èª¿è½‰å­—å°¾èª¿</div>
                    <div class="dropdown-item" onclick="convertPinyin('matsu', 'tone-to-letter')">å­—å°¾èª¿è½‰å­—æ¯èª¿</div>
                </div>
            </div>
            <button class="toolbar-btn-text" onclick="searchDictionary('matsu')" title="æŸ¥è¾­å…¸">
                <span class="material-icons">book</span>
                <span class="btn-text">æŸ¥è¾­å…¸</span>
            </button>
        </div>
    </div>
	</div>


    <div class="main-content">
        <div class="editor-container">
            <div class="editor-wrapper">
                <textarea class="editor" id="editor" placeholder="çƒè¡£è¡Œï¼šåˆ‡æ›åˆ°è‹±æ•¸éµç›¤ä¾†è¼¸å…¥..."></textarea>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <div><span id="lineCount">1</span>è¡Œ  <span id="charCount">0</span>å­— </div>
		<div id="ime-external-toolbar-container" class="ime-external-toolbar"></div>
        <div style="display: flex; align-items: center; gap: 8px;">
            <button class="toolbar-btn" onclick="toggleFullscreen()" title="å…¨è¢å¹•" style="width: 24px; height: 24px; font-size: 16px;"><span class="material-icons">fullscreen</span></button>
        </div>
    </div>
	

    <!-- å°‹æ‰¾èˆ‡å–ä»£é¢æ¿ -->
    <div class="find-panel" id="findPanel" style="display: none;">
        <div class="find-panel-header">
            <span class="material-icons drag-handle">drag_indicator</span>
            <span class="match-count" id="matchCount" style="font-size: 13px; color: #666; margin-left: 8px;"></span>
            <button class="close-btn" onclick="closeFindModal()">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div class="find-panel-content">
            <div class="find-row">
                <label>å°‹æ‰¾</label>
                <input type="text" id="findText" placeholder="è¼¸å…¥æœå°‹æ–‡å­—">
                <button class="find-btn" onclick="findPrevious()" title="ä¸Šä¸€å€‹">
                    <span class="material-icons">keyboard_arrow_up</span>
                </button>
                <button class="find-btn" onclick="findNext()" title="ä¸‹ä¸€å€‹">
                    <span class="material-icons">keyboard_arrow_down</span>
                </button>
            </div>
            <div class="find-row">
                <label>å–ä»£</label>
                <input type="text" id="replaceText" placeholder="è¼¸å…¥å–ä»£æ–‡å­—">
                <button class="find-btn" onclick="replaceCurrent()" title="å–ä»£">
                    <span class="material-icons">check</span>
                </button>
                <button class="find-btn" onclick="replaceAll()" title="å…¨éƒ¨å–ä»£">
                    <span class="material-icons">done_all</span>
                </button>
            </div>
            <div class="find-options">
                <label class="checkbox-label">
                    <input type="checkbox" id="replaceInSelection">
                    <span>é¸å–ç¯„åœ</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="useRegex">
                    <span>æ­£å‰‡</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="matchCase">
                    <span>å¤§å°å¯«</span>
                </label>
            </div>
        </div>
    </div>

    <div class="modal" id="wordCountModal">
        <div class="modal-content">
            <div class="modal-header">æ–‡ä»¶çµ±è¨ˆ</div>
            <div style="line-height: 1.8;">
                <div>å­—å…ƒæ•¸ï¼ˆå«ç©ºæ ¼ï¼‰: <span id="totalChars">0</span></div>
                <div>å­—å…ƒæ•¸ï¼ˆä¸å«ç©ºæ ¼ï¼‰: <span id="charsNoSpace">0</span></div>
                <div>å–®å­—æ•¸: <span id="wordCount">0</span></div>
                <div>è¡Œæ•¸: <span id="totalLines">1</span></div>
                <div>æ®µè½æ•¸: <span id="paragraphCount">1</span></div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeWordCountModal()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <div class="modal" id="newDocumentModal">
        <div class="modal-content">
            <div class="modal-header">å»ºç«‹æ–°æ–‡ä»¶</div>
            <div style="line-height: 1.6; margin-bottom: 16px;">
                <p>æ‚¨ç¢ºå®šè¦å»ºç«‹æ–°æ–‡ä»¶å—ï¼Ÿ</p>
                <p style="color: #666; font-size: 14px;">ç›®å‰çš„æ–‡å­—å…§å®¹å°‡æœƒæ¸…ç©ºã€‚å¦‚æœæ‚¨å·²å•Ÿç”¨è‡ªå‹•å„²å­˜ï¼Œå…§å®¹æœƒä¿å­˜åœ¨æœ¬æ©Ÿå„²å­˜ä¸­ã€‚</p>
            </div>
            <div class="modal-buttons">
                <button class="btn" onclick="closeNewDocumentModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmNewDocument()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <!-- è¾­å…¸å´é‚Šæ¬„ -->
    <div class="dictionary-sidebar" id="dictionarySidebar">
        <div class="dictionary-header">
            <div class="dictionary-title">è¾­å…¸æŸ¥è©¢</div>
            <button class="dictionary-close" onclick="closeDictionarySidebar()">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div class="dictionary-content">
            <div class="dictionary-search">
                <div class="search-input-group">
                    <input type="text" id="dictionarySearchInput" placeholder="è¼¸å…¥è¦æŸ¥è©¢çš„è©å½™..." onkeypress="if(event.key==='Enter') performDictionarySearch()">
                    <button class="search-btn" onclick="performDictionarySearch()">
                        <span class="material-icons">search</span>
                    </button>
                </div>
            </div>
            <div class="dictionary-results" id="dictionaryResults">
                <div class="dictionary-placeholder">
                    <span class="material-icons" style="font-size: 48px; color: #ccc;">book</span>
                    <p style="color: #666; margin-top: 16px;">è«‹è¼¸å…¥è©å½™é€²è¡ŒæŸ¥è©¢</p>
                </div>
            </div>
        </div>
    </div>


    <!-- å´é‚Šæ¬„ -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">çƒè¡£è¡Œè¨­å®š</div>
            <button class="sidebar-close" onclick="closeSidebar()">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div class="sidebar-content">
            <div class="sidebar-section">
                <h3>æª”æ¡ˆ</h3>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <button class="btn" onclick="newDocument(); closeSidebar();" style="justify-content: flex-start; padding: 12px 16px;">
                        <span class="material-icons" style="margin-right: 8px;">description</span>
                        é–‹æ–°æª”æ¡ˆ
                    </button>
                    <button class="btn" onclick="openFile(); closeSidebar();" style="justify-content: flex-start; padding: 12px 16px;">
                        <span class="material-icons" style="margin-right: 8px;">folder_open</span>
                        é–‹å•ŸèˆŠæª”
                    </button>
                    <button class="btn" onclick="saveFile(); closeSidebar();" style="justify-content: flex-start; padding: 12px 16px;">
                        <span class="material-icons" style="margin-right: 8px;">download</span>
                        ä¸‹è¼‰æª”æ¡ˆ
                    </button>
                    <button class="btn" onclick="showWordCount(); closeSidebar();" style="justify-content: flex-start; padding: 12px 16px;">
                        <span class="material-icons" style="margin-right: 8px;">text_fields</span>
                        æ–‡ä»¶çµ±è¨ˆ
                    </button>
					<!-- 
                    <button class="btn" onclick="showAbout(); closeSidebar();" style="justify-content: flex-start; padding: 12px 16px;">
                        <span class="material-icons" style="margin-right: 8px;">info</span>
                        èªªæ˜
                    </button>
					-->
                </div>
            </div>
            <div class="sidebar-section">
                <h3>è‡ªå‹•å„²å­˜</h3>
                <label class="checkbox-label">
                    <input type="checkbox" id="autoSaveEnabled" checked onchange="toggleAutoSaveFromSidebar()">
                    <span>å•Ÿç”¨è‡ªå‹•å„²å­˜åˆ°æœ¬æ©Ÿ</span>
                </label>
            </div>


			<!-- 
            <div class="sidebar-section> 
                <h3>é¡¯ç¤ºé¸å–®</h3>
                <div class="checkbox-grid">
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-sixian" checked onchange="toggleMenuVisibility('sixian')">
                        <span>å››ç¸£</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-hailu" checked onchange="toggleMenuVisibility('hailu')">
                        <span>æµ·é™¸</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-dabu" checked onchange="toggleMenuVisibility('dabu')">
                        <span>å¤§åŸ”</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-raoping" checked onchange="toggleMenuVisibility('raoping')">
                        <span>é¥’å¹³</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-zhaoan" checked onchange="toggleMenuVisibility('zhaoan')">
                        <span>è©”å®‰</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-hele" checked onchange="toggleMenuVisibility('hele')">
                        <span>å’Œæ¨‚</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-matsu" checked onchange="toggleMenuVisibility('matsu')">
                        <span>é¦¬ç¥–</span>
                    </label>
                </div>
            </div>
			-->

        </div>
    </div>

    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">é¸å–®è¨­å®š</div>
            <div class="settings-section">
                <h3>è‡ªå‹•å„²å­˜</h3>
                <label class="checkbox-label">
                    <input type="checkbox" id="autoSaveEnabled" checked onchange="toggleAutoSaveFromSidebar()">
                    <span>å•Ÿç”¨è‡ªå‹•å„²å­˜åˆ°æœ¬æ©Ÿ</span>
                </label>
            </div>
            <div class="settings-section">
                <h3>é¡¯ç¤ºé¸å–®</h3>
                <div class="checkbox-grid">
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-home" checked>
                        <span>é¦–é </span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-insert" checked>
                        <span>æ’å…¥</span>
                    </label>

                    <label class="checkbox-label">
                        <input type="checkbox" id="show-sixian" checked>
                        <span>å››ç¸£</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-hailu" checked>
                        <span>æµ·é™¸</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-dabu" checked>
                        <span>å¤§åŸ”</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-raoping" checked>
                        <span>é¥’å¹³</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-zhaoan" checked>
                        <span>è©”å®‰</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-hele" checked>
                        <span>å’Œæ¨‚</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-matsu" checked>
                        <span>é¦¬ç¥–</span>
                    </label>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn" onclick="closeSettings()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveSettings()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        let currentZoom = 100;
        let undoStack = [];
        let redoStack = [];
        let currentContent = '';
        let autoSaveEnabled = true;
        let autoSaveInterval;
        let selectedRange = null;

        // LocalStorage å‰ç¶´
        const STORAGE_PREFIX = 'wuyixing_editor_';

        // åˆå§‹åŒ–
        editor.addEventListener('input', function() {
            updateStatus();
            saveToUndoStack();
            if (autoSaveEnabled) {
                autoSave();
            }
        });
        

        
        // è¼‰å…¥è¨­å®šå’Œå…§å®¹
        loadSettings();
        loadAutoSavedContent();
        loadFontSettings();

        // é¸å–®åˆ‡æ›
        function switchTab(tab) {
            // æ›´æ–°é¸å–®æ¨£å¼
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');

            // é¡¯ç¤ºå°æ‡‰å·¥å…·åˆ—
            document.querySelectorAll('.toolbar').forEach(toolbar => {
                toolbar.style.display = 'none';
            });
            
            let toolbarId = tab + 'Toolbar';
            const toolbar = document.getElementById(toolbarId);
            if (toolbar) {
                toolbar.style.display = 'flex';
            }
        }

        // å´é‚Šæ¬„åŠŸèƒ½
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.add('open');
            overlay.classList.add('show');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('show');
        }

        function toggleAutoSaveFromSidebar() {
            const autoSaveCheckbox = document.getElementById('autoSaveEnabled');
            if (autoSaveCheckbox) {
                autoSaveEnabled = autoSaveCheckbox.checked;
                localStorage.setItem(STORAGE_PREFIX + 'autoSaveEnabled', autoSaveEnabled);
                
                const autoSaveBtn = document.getElementById('autoSaveBtn');
                if (autoSaveEnabled) {
                    autoSaveBtn.classList.add('active');
                    autoSaveBtn.title = 'è‡ªå‹•å„²å­˜ï¼šå·²å•Ÿç”¨';
                } else {
                    autoSaveBtn.classList.remove('active');
                    autoSaveBtn.title = 'è‡ªå‹•å„²å­˜ï¼šå·²åœç”¨';
                }
            }
        }

        function toggleMenuVisibility(menu) {
            const checkbox = document.getElementById(`show-${menu}`);
            const menuItem = document.getElementById(`menu-${menu}`);
            
            if (checkbox && menuItem) {
                const isVisible = checkbox.checked;
                localStorage.setItem(STORAGE_PREFIX + 'show_' + menu, isVisible);
                menuItem.style.display = isVisible ? 'block' : 'none';
                
                // é‡æ–°æª¢æŸ¥é¸å–®å¯¬åº¦
                checkMenuOverflow();
            }
        }

        // æ›´å¤šé¸å–®åŠŸèƒ½
        function checkMenuOverflow() {
            const menuItems = document.getElementById('menuItems');
            const moreBtn = document.getElementById('moreBtn');
            const moreDropdown = document.getElementById('moreDropdown');
            
            // é‡ç½®æ‰€æœ‰é …ç›®åˆ°ä¸»é¸å–®
            const hiddenItems = moreDropdown.querySelectorAll('.menu-item');
            hiddenItems.forEach(item => {
                menuItems.appendChild(item);
            });
            
            // éš±è—æ›´å¤šæŒ‰éˆ•
            moreBtn.style.display = 'none';
            
            // æª¢æŸ¥æ˜¯å¦æº¢å‡º
            const containerWidth = menuItems.parentElement.offsetWidth - 100; // é ç•™æ›´å¤šæŒ‰éˆ•ç©ºé–“
            let totalWidth = 0;
            const items = Array.from(menuItems.children);
            
            items.forEach((item, index) => {
                if (index === 0) return; // è·³éçƒè¡£è¡Œæ¨™é¡Œ
                
                totalWidth += item.offsetWidth + 8; // åŠ ä¸Šé–“è·
                
                if (totalWidth > containerWidth) {
                    // ç§»å‹•åˆ°æ›´å¤šé¸å–®
                    moreDropdown.appendChild(item);
                    moreBtn.style.display = 'block';
                }
            });
        }

        function toggleMoreMenu() {
            const dropdown = document.getElementById('moreDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        // ç›£è½è¦–çª—å¤§å°è®ŠåŒ–
        window.addEventListener('resize', checkMenuOverflow);
        window.addEventListener('load', checkMenuOverflow);

        // é»æ“Šå¤–éƒ¨é—œé–‰ä¸‹æ‹‰é¸å–®
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
                document.querySelectorAll('.dropdown-toggle').forEach(btn => {
                    btn.classList.remove('open');
                });
            }
        });

        // æ–‡ä»¶æ“ä½œ
        function newDocument() {
            if (editor.value) {
                document.getElementById('newDocumentModal').style.display = 'block';
            } else {
                confirmNewDocument();
            }
        }

        function closeNewDocumentModal() {
            document.getElementById('newDocumentModal').style.display = 'none';
        }

		function confirmNewDocument() {
			editor.value = '';
			updateStatus();
			undoStack = [];
			redoStack = [];
			clearHighlights();
			closeNewDocumentModal();
		}

        function openFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        editor.value = e.target.result;
                        updateStatus();
                        clearSearchHighlights();
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // è‡ªå‹•å„²å­˜åŠŸèƒ½
        function autoSave() {
            if (autoSaveEnabled) {
                localStorage.setItem(STORAGE_PREFIX + 'content', editor.value);
                localStorage.setItem(STORAGE_PREFIX + 'timestamp', new Date().toISOString());
            }
        }

        function loadAutoSavedContent() {
            const savedContent = localStorage.getItem(STORAGE_PREFIX + 'content');
            if (savedContent && !editor.value) {
                editor.value = savedContent;
                updateStatus();
            }
        }

        function toggleAutoSave() {
            autoSaveEnabled = !autoSaveEnabled;
            const btn = document.getElementById('autoSaveBtn');
            if (autoSaveEnabled) {
                btn.classList.add('active');
                btn.title = 'è‡ªå‹•å„²å­˜ï¼šå·²å•Ÿç”¨';
                autoSave();
            } else {
                btn.classList.remove('active');
                btn.title = 'è‡ªå‹•å„²å­˜ï¼šå·²åœç”¨';
            }
            localStorage.setItem(STORAGE_PREFIX + 'autoSaveEnabled', autoSaveEnabled);
        }

        // è¼‰å…¥å’Œå„²å­˜è¨­å®š
        function loadSettings() {
            // è¼‰å…¥è‡ªå‹•å„²å­˜è¨­å®š
            const savedAutoSave = localStorage.getItem(STORAGE_PREFIX + 'autoSaveEnabled');
            if (savedAutoSave !== null) {
                autoSaveEnabled = savedAutoSave === 'true';
            }
            
            const autoSaveBtn = document.getElementById('autoSaveBtn');
            const autoSaveCheckbox = document.getElementById('autoSaveEnabled');
            
            if (autoSaveEnabled) {
                autoSaveBtn.classList.add('active');
                autoSaveBtn.title = 'è‡ªå‹•å„²å­˜ï¼šå·²å•Ÿç”¨';
                if (autoSaveCheckbox) autoSaveCheckbox.checked = true;
            } else {
                autoSaveBtn.classList.remove('active');
                autoSaveBtn.title = 'è‡ªå‹•å„²å­˜ï¼šå·²åœç”¨';
                if (autoSaveCheckbox) autoSaveCheckbox.checked = false;
            }

            // è¼‰å…¥é¸å–®é¡¯ç¤ºè¨­å®š
            const menus = ['sixian', 'hailu', 'dabu', 'raoping', 'zhaoan', 'hele', 'matsu'];
            menus.forEach(menu => {
                const saved = localStorage.getItem(STORAGE_PREFIX + 'show_' + menu);
                const checkbox = document.getElementById(`show-${menu}`);
                const menuItem = document.getElementById(`menu-${menu}`);
                
                if (saved !== null) {
                    const isVisible = saved === 'true';
                    if (checkbox) checkbox.checked = isVisible;
                    if (menuItem) {
                        menuItem.style.display = isVisible ? 'block' : 'none';
                    }
                } else {
                    // é è¨­é¡¯ç¤ºæ‰€æœ‰é¸å–®
                    if (checkbox) checkbox.checked = true;
                    if (menuItem) {
                        menuItem.style.display = 'block';
                    }
                }
            });
        }

        function saveFile() {
            const content = editor.value;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'æ–‡ä»¶.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¾©åŸ/é‡åš
        function saveToUndoStack() {
            if (editor.value !== currentContent) {
                undoStack.push(currentContent);
                if (undoStack.length > 50) undoStack.shift();
                redoStack = [];
                currentContent = editor.value;
            }
        }

        function undo() {
            if (undoStack.length > 0) {
                redoStack.push(editor.value);
                editor.value = undoStack.pop();
                currentContent = editor.value;
                updateStatus();
            }
        }

        function redo() {
            if (redoStack.length > 0) {
                undoStack.push(editor.value);
                editor.value = redoStack.pop();
                currentContent = editor.value;
                updateStatus();
            }
        }

        function insertAtCursor(text) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const value = editor.value;
            editor.value = value.substring(0, start) + text + value.substring(end);
            editor.selectionStart = editor.selectionEnd = start + text.length;
            editor.focus();
            updateStatus();
        }



        // å°‹æ‰¾èˆ‡å–ä»£
        let currentMatches = [];
        let currentMatchIndex = -1;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        function findReplace() {
            // ä¿å­˜ç•¶å‰é¸å–ç¯„åœ
            if (editor.selectionStart !== editor.selectionEnd) {
                selectedRange = {
                    start: editor.selectionStart,
                    end: editor.selectionEnd,
                    text: editor.value.substring(editor.selectionStart, editor.selectionEnd)
                };
                
                // åªæœ‰å–®è¡Œæ–‡å­—æ‰è‡ªå‹•å¡«å…¥æœå°‹æ¡†
                if (!selectedRange.text.includes('\n')) {
                    document.getElementById('findText').value = selectedRange.text;
                }
            }
            
            const panel = document.getElementById('findPanel');
            panel.style.display = 'block';
            document.getElementById('findText').focus();
        }

        function closeFindModal() {
            document.getElementById('findPanel').style.display = 'none';
            selectedRange = null;
        }



        function createRegexPattern(text, useRegex, matchCase) {
            if (useRegex) {
                try {
                    return new RegExp(text, matchCase ? 'g' : 'gi');
                } catch (e) {
                    return null;
                }
            } else {
                const escapedText = text.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                return new RegExp(escapedText, matchCase ? 'g' : 'gi');
            }
        }

        function findMatches() {
            const findText = document.getElementById('findText').value;
            const useRegex = document.getElementById('useRegex').checked;
            const matchCase = document.getElementById('matchCase').checked;
            
            if (!findText) {
                clearHighlights();
                return;
            }

            const pattern = createRegexPattern(findText, useRegex, matchCase);
            if (!pattern) {
                document.getElementById('matchCount').textContent = 'æ­£å‰‡è¡¨é”å¼éŒ¯èª¤';
                return;
            }

            const content = editor.value;
            currentMatches = [];
            let match;

            while ((match = pattern.exec(content)) !== null) {
                currentMatches.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    text: match[0]
                });
                if (!pattern.global) break;
            }

            updateMatchCount();
            updateSearchOverlay();
        }

        function updateMatchCount() {
            const count = currentMatches.length;
            const current = currentMatchIndex >= 0 ? currentMatchIndex + 1 : 0;
            document.getElementById('matchCount').textContent = 
                count > 0 ? `${current}/${count}` : count === 0 ? 'æ‰¾ä¸åˆ°ç¬¦åˆé …ç›®' : '';
        }

        function highlightMatches() {
            // å°‡ç•¶å‰åŒ¹é…é …åç™½ä¸¦æ»¾å‹•åˆ°å¯è¦‹ç¯„åœ
            if (currentMatches.length > 0 && currentMatchIndex >= 0) {
                const match = currentMatches[currentMatchIndex];
                editor.setSelectionRange(match.start, match.end);
                editor.focus();
                
                // æ»¾å‹•åˆ°å¯è¦‹ç¯„åœ
                const textBeforeMatch = editor.value.substring(0, match.start);
                const lineNumber = textBeforeMatch.split('\n').length - 1;
                const lineHeight = 24; // é è¨­è¡Œé«˜
                const scrollTop = lineNumber * lineHeight - editor.clientHeight / 2;
                editor.scrollTop = Math.max(0, scrollTop);
            }
        }

        function clearHighlights() {
            currentMatches = [];
            currentMatchIndex = -1;
            updateMatchCount();
        }

        function findNext() {
            if (currentMatches.length === 0) {
                findMatches();
            }
            if (currentMatches.length > 0) {
                currentMatchIndex = (currentMatchIndex + 1) % currentMatches.length;
                highlightMatches();
                updateMatchCount();
            }
        }

        function findPrevious() {
            if (currentMatches.length === 0) {
                findMatches();
            }
            if (currentMatches.length > 0) {
                currentMatchIndex = currentMatchIndex <= 0 ? currentMatches.length - 1 : currentMatchIndex - 1;
                highlightMatches();
                updateMatchCount();
            }
        }

        function replaceCurrent() {
            if (currentMatchIndex >= 0 && currentMatches.length > 0) {
                const match = currentMatches[currentMatchIndex];
                const replaceText = document.getElementById('replaceText').value;
                const content = editor.value;
                const lengthDiff = replaceText.length - (match.end - match.start);
                
                // åŸ·è¡Œå–ä»£
                editor.value = content.substring(0, match.start) + replaceText + content.substring(match.end);
                
                updateStatus();
                
                // é‡æ–°æœå°‹ä¸¦æ›´æ–°åŒ¹é…é …
                setTimeout(() => {
                    const oldMatchIndex = currentMatchIndex;
                    findMatches();
                    
                    if (currentMatches.length > 0) {
                        // èª¿æ•´å¾ŒçºŒåŒ¹é…é …çš„ä½ç½®
                        for (let i = 0; i < currentMatches.length; i++) {
                            if (currentMatches[i].start > match.start) {
                                currentMatches[i].start += lengthDiff;
                                currentMatches[i].end += lengthDiff;
                            }
                        }
                        
                        // æ‰¾åˆ°ä¸‹ä¸€å€‹è¦åç™½çš„åŒ¹é…é …
                        let nextIndex = -1;
                        for (let i = 0; i < currentMatches.length; i++) {
                            if (currentMatches[i].start >= match.start + replaceText.length) {
                                nextIndex = i;
                                break;
                            }
                        }
                        
                        // å¦‚æœæ²’æ‰¾åˆ°å¾Œé¢çš„åŒ¹é…é …ï¼Œå¾é ­é–‹å§‹
                        if (nextIndex === -1 && currentMatches.length > 0) {
                            nextIndex = 0;
                        }
                        
                        if (nextIndex >= 0) {
                            currentMatchIndex = nextIndex;
                            highlightMatches();
                            updateMatchCount();
                        }
                    } else {
                        // æ²’æœ‰æ›´å¤šåŒ¹é…é …
                        currentMatchIndex = -1;
                        updateMatchCount();
                    }
                }, 10);
            }
        }

        function replaceAll() {
            const findText = document.getElementById('findText').value;
            const replaceText = document.getElementById('replaceText').value;
            const useRegex = document.getElementById('useRegex').checked;
            const matchCase = document.getElementById('matchCase').checked;
            const replaceInSelection = document.getElementById('replaceInSelection').checked;
            
            if (!findText) return;
            
            const pattern = createRegexPattern(findText, useRegex, matchCase);
            if (!pattern) return;

            let content = editor.value;
            let newContent;
            
            if (replaceInSelection && selectedRange) {
                // åªåœ¨é¸å–ç¯„åœå…§å–ä»£
                const selectionStart = selectedRange.start;
                const selectionEnd = selectedRange.end;
                const selectedText = content.substring(selectionStart, selectionEnd);
                const replacedSelection = selectedText.replace(pattern, replaceText);
                
                newContent = content.substring(0, selectionStart) + replacedSelection + content.substring(selectionEnd);
                editor.value = newContent;
                editor.setSelectionRange(selectionStart, selectionStart + replacedSelection.length);
            } else {
                // å…¨æ–‡å–ä»£
                newContent = content.replace(pattern, replaceText);
                editor.value = newContent;
            }
            
            updateStatus();
            findMatches();
        }

// æ‹–æ‹½åŠŸèƒ½
        function initDragFunctionality() {
            const panel = document.getElementById('findPanel');
            const header = panel.querySelector('.find-panel-header');

            const dragStart = function(e) {
                // å¦‚æœé»æ“Šçš„æ˜¯é—œé–‰æŒ‰éˆ•ï¼Œå‰‡ä¸è§¸ç™¼æ‹–æ›³
                if (e.target.closest('.close-btn')) return;
                // åªè™•ç†æ»‘é¼ å·¦éµ
                if (e.type === 'mousedown' && e.button !== 0) return;

                isDragging = true;
                const rect = panel.getBoundingClientRect();
                
                // [ä¿®æ­£] å…¼å®¹æ»‘é¼ èˆ‡è§¸æ§äº‹ä»¶çš„åº§æ¨™
                const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;

                dragOffset.x = clientX - rect.left;
                dragOffset.y = clientY - rect.top;
                
                // [ä¿®æ­£] è¨»å†Šäº‹ä»¶ç›£è½ï¼Œä¸¦ç‚º touchmove åŠ ä¸Š { passive: false }
                // é€™æ˜¯å‘Šè¨´ç€è¦½å™¨æˆ‘å€‘å¯èƒ½æœƒé˜»æ­¢é è¨­çš„æ»¾å‹•è¡Œç‚ºï¼Œéå¸¸é—œéµ
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('touchmove', handleDrag, { passive: false });
                
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchend', stopDrag);

                // [æ–°å¢] åœ¨è§¸æ§é–‹å§‹æ™‚å°±é˜»æ­¢é è¨­è¡Œç‚º (å¦‚é é¢æ»¾å‹•æˆ–æ–‡å­—é¸å–)
                if (e.cancelable) {
                    e.preventDefault();
                }
            };

            header.addEventListener('mousedown', dragStart);
            header.addEventListener('touchstart', dragStart);
        }

        function handleDrag(e) {
            if (!isDragging) return;
            
            // [æ–°å¢] åœ¨è§¸æ§ç§»å‹•éç¨‹ä¸­ï¼ŒæŒçºŒé˜»æ­¢é é¢æ»¾å‹•
            if (e.type === 'touchmove' && e.cancelable) {
                e.preventDefault();
            }
            
            // [ä¿®æ­£] å…¼å®¹æ»‘é¼ èˆ‡è§¸æ§äº‹ä»¶çš„åº§æ¨™
            const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;

            const newX = clientX - dragOffset.x;
            const newY = clientY - dragOffset.y;
            
            const panel = document.getElementById('findPanel');
            panel.style.top = Math.max(0, Math.min(newY, window.innerHeight - panel.offsetHeight)) + 'px';
            panel.style.left = Math.max(0, Math.min(newX, window.innerWidth - panel.offsetWidth)) + 'px';
            
            // [æœ€é—œéµçš„ä¿®æ­£]
            // ç•¶æˆ‘å€‘é–‹å§‹ç”¨ 'left' ä¾†å®šä½æ™‚ï¼Œå¿…é ˆæ¸…é™¤ 'right' çš„å®šä½ï¼Œ
            // å¦å‰‡ CSS è¦å‰‡æœƒè¡çªï¼Œå°è‡´é¢æ¿ä¸å‹•ã€‚
            panel.style.right = 'auto';
        }

        function stopDrag() {
            isDragging = false;
            // [ä¿®æ­£] ç¢ºä¿æ‰€æœ‰ç§»å‹•å’ŒçµæŸäº‹ä»¶çš„ç›£è½å™¨éƒ½è¢«ç§»é™¤
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('touchmove', handleDrag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchend', stopDrag);
        }

        // ç›£è½è¼¸å…¥è®ŠåŒ–
        document.getElementById('findText').addEventListener('input', findMatches);
        document.getElementById('useRegex').addEventListener('change', findMatches);
        document.getElementById('matchCase').addEventListener('change', findMatches);

        // æª¢è¦–åŠŸèƒ½
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function zoomIn() {
            currentZoom += 10;
            updateZoom();
        }

        function zoomOut() {
            if (currentZoom > 50) {
                currentZoom -= 10;
                updateZoom();
            }
        }

        function updateZoom() {
            document.body.style.zoom = currentZoom + '%';
            document.getElementById('zoomLevel').textContent = currentZoom + '%';
        }

        // è¤‡è£½ã€å‰ªä¸‹ã€è²¼ä¸Šã€å…¨é¸åŠŸèƒ½
        function copyText() {
            const selectedText = editor.value.substring(editor.selectionStart, editor.selectionEnd);
            if (selectedText) {
                navigator.clipboard.writeText(selectedText).then(() => {
                    // å¯ä»¥æ·»åŠ æç¤ºè¨Šæ¯
                }).catch(() => {
                    // å‚™ç”¨æ–¹æ³•
                    editor.select();
                    document.execCommand('copy');
                });
            } else {
                alert('è«‹å…ˆé¸å–è¦è¤‡è£½çš„æ–‡å­—');
            }
        }

        function cutText() {
            const selectedText = editor.value.substring(editor.selectionStart, editor.selectionEnd);
            if (selectedText) {
                navigator.clipboard.writeText(selectedText).then(() => {
                    const start = editor.selectionStart;
                    const end = editor.selectionEnd;
                    editor.value = editor.value.substring(0, start) + editor.value.substring(end);
                    editor.selectionStart = editor.selectionEnd = start;
                    updateStatus();
                }).catch(() => {
                    // å‚™ç”¨æ–¹æ³•
                    document.execCommand('cut');
                    updateStatus();
                });
            } else {
                alert('è«‹å…ˆé¸å–è¦å‰ªä¸‹çš„æ–‡å­—');
            }
        }

        function pasteText() {
            navigator.clipboard.readText().then(text => {
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                editor.value = editor.value.substring(0, start) + text + editor.value.substring(end);
                editor.selectionStart = editor.selectionEnd = start + text.length;
                updateStatus();
            }).catch(() => {
                // å‚™ç”¨æ–¹æ³• - æç¤ºç”¨æˆ¶ä½¿ç”¨ Ctrl+V
                alert('è«‹ä½¿ç”¨ Ctrl+V ä¾†è²¼ä¸Šæ–‡å­—');
            });
        }

        function selectAll() {
            editor.select();
            editor.focus();
        }

        // å­—æ•¸çµ±è¨ˆ
        function showWordCount() {
            const content = editor.value;
            // ä½¿ç”¨ Array.from æ­£ç¢ºè¨ˆç®—åŒ…å« Unicode å­—ç¬¦çš„å­—æ•¸
            const totalChars = Array.from(content).length;
            const charsNoSpace = Array.from(content.replace(/\s/g, '')).length;
            const words = content.trim() ? content.trim().split(/\s+/).length : 0;
            const lines = content.split('\n').length;
            const paragraphs = content.trim() ? content.split(/\n\s*\n/).length : 0;

            document.getElementById('totalChars').textContent = totalChars;
            document.getElementById('charsNoSpace').textContent = charsNoSpace;
            document.getElementById('wordCount').textContent = words;
            document.getElementById('totalLines').textContent = lines;
            document.getElementById('paragraphCount').textContent = paragraphs;
            
            document.getElementById('wordCountModal').style.display = 'block';
        }

        function closeWordCountModal() {
            document.getElementById('wordCountModal').style.display = 'none';
        }

        // ç‹€æ…‹æ›´æ–°
        function updateStatus() {
            const content = editor.value;
            // ä½¿ç”¨ Array.from æ­£ç¢ºè¨ˆç®—åŒ…å« Unicode å­—ç¬¦çš„å­—æ•¸ï¼ˆä¸å«ç©ºç™½ï¼‰
            const charsNoSpace = Array.from(content.replace(/\s/g, '')).length;
            document.getElementById('charCount').textContent = charsNoSpace;
            document.getElementById('lineCount').textContent = content.split('\n').length;
        }

        // å®¢èªç¿»è­¯åŠŸèƒ½
        function translateToHakka(dialect) {
            const selectedText = getSelectedText();
            if (!selectedText) {
                alert('è«‹å…ˆé¸å–è¦ç¿»è­¯çš„æ–‡å­—');
                return;
            }
            
            // é€™è£¡æ˜¯ç¤ºç¯„åŠŸèƒ½ï¼Œå¯¦éš›æ‡‰ç”¨éœ€è¦é€£æ¥çœŸå¯¦çš„ç¿»è­¯API
            const translatedText = `[${dialect}å®¢èªç¿»è­¯] ${selectedText}`;
            replaceSelectedText(translatedText);
        }

        function translateToTaiwanese(dialect) {
            const selectedText = getSelectedText();
            if (!selectedText) {
                alert('è«‹å…ˆé¸å–è¦ç¿»è­¯çš„æ–‡å­—');
                return;
            }
            
            const translatedText = `[å°èªç¿»è­¯] ${selectedText}`;
            replaceSelectedText(translatedText);
        }

        function translateToFuzhou(dialect) {
            const selectedText = getSelectedText();
            if (!selectedText) {
                alert('è«‹å…ˆé¸å–è¦ç¿»è­¯çš„æ–‡å­—');
                return;
            }
            
            const translatedText = `[ç¦å·è©±ç¿»è­¯] ${selectedText}`;
            replaceSelectedText(translatedText);
        }

        function translateToMandarin(dialect) {
            const selectedText = getSelectedText();
            if (!selectedText) {
                alert('è«‹å…ˆé¸å–è¦ç¿»è­¯çš„æ–‡å­—');
                return;
            }
            
            const translatedText = `[è¯èªç¿»è­¯] ${selectedText}`;
            replaceSelectedText(translatedText);
        }

        function toPinyin(dialect) {
            const selectedText = getSelectedText();
            if (!selectedText) {
                alert('è«‹å…ˆé¸å–è¦è½‰æ›æ‹¼éŸ³çš„æ–‡å­—');
                return;
            }
            
            const pinyinText = `[${dialect}æ‹¼éŸ³] ${selectedText}`;
            replaceSelectedText(pinyinText);
        }

        function convertPinyin(dialect) {
            const selectedText = getSelectedText();
            if (!selectedText) {
                alert('è«‹å…ˆé¸å–è¦è½‰æ›çš„æ‹¼éŸ³');
                return;
            }
            
            const convertedText = `[æ‹¼éŸ³è½‰æ›] ${selectedText}`;
            replaceSelectedText(convertedText);
        }

        function togglePinyinDropdown(dialect) {
            const dropdown = document.getElementById(`pinyinDropdown-${dialect}`);
            const toggle = event.target.closest('.dropdown-toggle');
            
            // é—œé–‰å…¶ä»–ä¸‹æ‹‰é¸å–®
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (menu !== dropdown) {
                    menu.classList.remove('show');
                }
            });
            document.querySelectorAll('.dropdown-toggle').forEach(btn => {
                if (btn !== toggle) {
                    btn.classList.remove('open');
                }
            });
            
            // åˆ‡æ›ç•¶å‰ä¸‹æ‹‰é¸å–®
            if (dropdown) {
                dropdown.classList.toggle('show');
                toggle.classList.toggle('open');
            }
        }

        function convertPinyin(dialect, type) {
            const selectedText = getSelectedText();
            if (!selectedText) {
                alert('è«‹å…ˆé¸å–è¦è½‰æ›æ‹¼éŸ³çš„æ–‡å­—');
                return;
            }
            
            let convertedText;
            switch(type) {
                case 'number-to-tone':
                    convertedText = `[${dialect}] ${selectedText} â†’ æ•¸å­—èª¿è½‰å­—å°¾èª¿ç¤ºç¯„`;
                    break;
                case 'tone-to-number':
                    convertedText = `[${dialect}] ${selectedText} â†’ å­—å°¾èª¿è½‰æ•¸å­—èª¿ç¤ºç¯„`;
                    break;
                case 'letter-to-tone':
                    convertedText = `[${dialect}] ${selectedText} â†’ å­—æ¯èª¿è½‰å­—å°¾èª¿ç¤ºç¯„`;
                    break;
                case 'tone-to-letter':
                    convertedText = `[${dialect}] ${selectedText} â†’ å­—å°¾èª¿è½‰å­—æ¯èª¿ç¤ºç¯„`;
                    break;
                default:
                    convertedText = `[${dialect}æ‹¼éŸ³] ${selectedText}`;
            }
            
            replaceSelectedText(convertedText);
            
            // é—œé–‰ä¸‹æ‹‰é¸å–®
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.remove('show');
            });
            document.querySelectorAll('.dropdown-toggle').forEach(btn => {
                btn.classList.remove('open');
            });
        }

        function searchDictionary(dialect) {
            const selectedText = getSelectedText();
            
            // ç›´æ¥é–‹å•Ÿè¾­å…¸å´é‚Šæ¬„
            openDictionarySidebar(dialect, selectedText);
        }

        function openDictionarySidebar(dialect, searchTerm) {
            const sidebar = document.getElementById('dictionarySidebar');
            const searchInput = document.getElementById('dictionarySearchInput');
            
            sidebar.classList.add('open');
            
            if (searchTerm) {
                searchInput.value = searchTerm;
                performDictionarySearch(dialect);
            }
        }

        function closeDictionarySidebar() {
            const sidebar = document.getElementById('dictionarySidebar');
            
            sidebar.classList.remove('open');
        }

        function performDictionarySearch(dialect) {
            const searchTerm = document.getElementById('dictionarySearchInput').value.trim();
            const resultsContainer = document.getElementById('dictionaryResults');
            
            if (!searchTerm) {
                resultsContainer.innerHTML = `
                    <div class="dictionary-placeholder">
                        <span class="material-icons" style="font-size: 48px; color: #ccc;">book</span>
                        <p style="color: #666; margin-top: 16px;">è«‹è¼¸å…¥è©å½™é€²è¡ŒæŸ¥è©¢</p>
                    </div>
                `;
                return;
            }
            
            // æ¨¡æ“¬è¾­å…¸æŸ¥è©¢çµæœ
            const sampleResults = generateSampleDictionaryResults(searchTerm, dialect || 'general');
            
            resultsContainer.innerHTML = sampleResults.length > 0 ? 
                sampleResults.map(result => `
                    <div class="dictionary-entry">
                        <div class="dictionary-word">${result.word}</div>
                        <div class="dictionary-pronunciation">${result.pronunciation}</div>
                        <div class="dictionary-definition">${result.definition}</div>
                        ${result.example ? `<div class="dictionary-example">${result.example}</div>` : ''}
                    </div>
                `).join('') :
                `<div class="dictionary-placeholder">
                    <span class="material-icons" style="font-size: 48px; color: #ccc;">search_off</span>
                    <p style="color: #666; margin-top: 16px;">æ‰¾ä¸åˆ°ã€Œ${searchTerm}ã€çš„ç›¸é—œçµæœ</p>
                </div>`;
        }

        function generateSampleDictionaryResults(searchTerm, dialect) {
            // é€™è£¡æ˜¯ç¤ºç¯„è³‡æ–™ï¼Œå¯¦éš›æ‡‰ç”¨éœ€è¦é€£æ¥çœŸå¯¦çš„è¾­å…¸API
            const sampleData = {
                'ä½ å¥½': [
                    {
                        word: 'ä½ å¥½',
                        pronunciation: 'nË‡ hoË‹',
                        definition: 'æ‹›å‘¼èªï¼Œç”¨æ–¼è¦‹é¢æ™‚çš„å•å€™ã€‚',
                        example: 'ä½¢åŒæˆ‘è¬›ã€Œä½ å¥½ã€ã€‚'
                    }
                ],
                'é£Ÿé£¯': [
                    {
                        word: 'é£Ÿé£¯',
                        pronunciation: 'siiÌt pnÌ„g',
                        definition: 'åƒé£¯ï¼Œé€²é£Ÿç±³é£¯æˆ–æ³›æŒ‡ç”¨é¤ã€‚',
                        example: 'æ™‚é–“åˆ°äº†ï¼Œæ„›é£Ÿé£¯äº†ã€‚'
                    }
                ],
                'å±‹ä¸‹': [
                    {
                        word: 'å±‹ä¸‹',
                        pronunciation: 'vuk haËŠ',
                        definition: 'å®¶è£¡ï¼Œä½æ‰€ã€‚',
                        example: 'æˆ‘è½‰å±‹ä¸‹å»äº†ã€‚'
                    }
                ]
            };
            
            return sampleData[searchTerm] || [
                {
                    word: searchTerm,
                    pronunciation: `[${dialect || 'ç¤ºç¯„'}æ‹¼éŸ³]`,
                    definition: `ã€Œ${searchTerm}ã€çš„è©ç¾©è§£é‡‹ï¼ˆç¤ºç¯„è³‡æ–™ï¼‰`,
                    example: `ä¾‹å¥ï¼š${searchTerm}çš„ä½¿ç”¨ç¯„ä¾‹ã€‚`
                }
            ];
        }

        function inputMethod(dialect) {
            alert(`æ­£åœ¨å•Ÿå‹•${dialect}è¼¸å…¥æ³•...`);
        }

        function getSelectedText() {
            return editor.value.substring(editor.selectionStart, editor.selectionEnd);
        }

        function replaceSelectedText(newText) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const content = editor.value;
            
            editor.value = content.substring(0, start) + newText + content.substring(end);
            editor.setSelectionRange(start, start + newText.length);
            updateStatus();
        }

        // è¨­å®šåŠŸèƒ½
        function showSettings() {
            document.getElementById('settingsModal').style.display = 'block';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function showAbout() {
            alert('çƒè¡£è¡Œæ–‡å­—ç·¨è¼¯å™¨\nç‰ˆæœ¬ï¼š1.0\næ”¯æ´å¤šç¨®å®¢èªæ–¹è¨€åŠå°èªã€ç¦å·è©±çš„æ–‡å­—è™•ç†å·¥å…·');
        }

        function saveSettings() {
            // å„²å­˜è‡ªå‹•å„²å­˜è¨­å®š
            const autoSaveCheckbox = document.getElementById('autoSaveEnabled');
            if (autoSaveCheckbox) {
                autoSaveEnabled = autoSaveCheckbox.checked;
                localStorage.setItem(STORAGE_PREFIX + 'autoSaveEnabled', autoSaveEnabled);
                
                const autoSaveBtn = document.getElementById('autoSaveBtn');
                if (autoSaveEnabled) {
                    autoSaveBtn.classList.add('active');
                    autoSaveBtn.title = 'è‡ªå‹•å„²å­˜ï¼šå·²å•Ÿç”¨';
                } else {
                    autoSaveBtn.classList.remove('active');
                    autoSaveBtn.title = 'è‡ªå‹•å„²å­˜ï¼šå·²åœç”¨';
                }
            }

            // å„²å­˜é¸å–®é¡¯ç¤ºè¨­å®š
            const menus = ['home', 'insert', 'view', 'settings', 'sixian', 'hailu', 'dabu', 'raoping', 'zhaoan', 'hele', 'matsu'];
            
            menus.forEach(menu => {
                const checkbox = document.getElementById(`show-${menu}`);
                const menuItem = document.getElementById(`menu-${menu}`) || document.querySelector(`.menu-item[onclick="switchTab('${menu}')"]`);
                
                if (checkbox && menuItem) {
                    const isVisible = checkbox.checked;
                    localStorage.setItem(STORAGE_PREFIX + 'show_' + menu, isVisible);
                    menuItem.style.display = isVisible ? 'block' : 'none';
                }
            });
            
            closeSettings();
        }

        // åˆå§‹åŒ–ç‹€æ…‹
        updateStatus();
        saveToUndoStack();
        initDragFunctionality();

        // å­—é«”å’Œå­—å‹å¤§å°è®Šæ›´åŠŸèƒ½
        function changeFontFamily() {
            const fontFamily = document.getElementById('fontFamily').value;
            editor.style.fontFamily = fontFamily;
            localStorage.setItem(STORAGE_PREFIX + 'fontFamily', fontFamily);
        }

        function changeFontSize() {
            const fontSize = document.getElementById('fontSize').value;
            editor.style.fontSize = fontSize + 'px';
            localStorage.setItem(STORAGE_PREFIX + 'fontSize', fontSize);
        }

        // è¼‰å…¥å­—é«”è¨­å®š
        function loadFontSettings() {
            const savedFontFamily = localStorage.getItem(STORAGE_PREFIX + 'fontFamily');
            const savedFontSize = localStorage.getItem(STORAGE_PREFIX + 'fontSize');
            
            if (savedFontFamily) {
                document.getElementById('fontFamily').value = savedFontFamily;
                editor.style.fontFamily = savedFontFamily;
            }
            
            if (savedFontSize) {
                document.getElementById('fontSize').value = savedFontSize;
                editor.style.fontSize = savedFontSize + 'px';
            }
        }
    </script>
    <script src="ime-dict.js"></script>
    <script src="ime.js"></script>
    <script src="ime-button.js"></script>
</html>
