<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¹å·å››åœ‹åœ°è³ªè€ƒå¯Ÿ</title>
    <style>

/* --- è®Šæ•¸è¨­å®š --- */
:root {
    --primary-color: #2c3e50;
    --accent-color: #2980b9;
    --highlight-color: #e67e22;
    --bg-color: #f4f6f7;
    --card-bg: #ffffff;
    --text-main: #333;
    --text-light: #7f8c8d;
    --border-radius: 12px;
    --nav-height: 60px;
    --safe-bottom: env(safe-area-inset-bottom);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    margin: 0; padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background-color: var(--bg-color); color: var(--text-main);
    padding-bottom: calc(var(--nav-height) + 20px + var(--safe-bottom));
    line-height: 1.5;
}

/* --- Header (ä¸å›ºå®š) --- */
.app-header {
    background: var(--primary-color); color: white;
    padding: 15px 20px;
    position: relative; 
    z-index: 100;
    display: flex; justify-content: space-between; align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.header-content h1 { margin: 0; font-size: 1.2rem; }
.header-content p { margin: 2px 0 0; font-size: 0.75rem; opacity: 0.8; }

.icon-btn {
    background: rgba(255,255,255,0.2); border: none; font-size: 1.5rem;
    width: 40px; height: 40px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center; cursor: pointer;
}
.pulse-animation { animation: pulse 2s infinite; }
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
    100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
}

#main-container { padding: 16px; max-width: 768px; margin: 0 auto; }
.view { display: none; animation: fadeIn 0.3s ease; }
.view.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.section-title {
    font-size: 0.9rem; font-weight: bold; color: var(--text-light);
    margin: 10px 5px; text-transform: uppercase; letter-spacing: 1px;
}

.card {
    background: var(--card-bg); border-radius: var(--border-radius);
    padding: 16px; margin-bottom: 16px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.03);
}
.highlight-card { border-left: 5px solid var(--highlight-color); }
.card-header { display: flex; align-items: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; }
.clickable-header { cursor: pointer; justify-content: space-between; margin-bottom: 0; border-bottom: none; }
.card-header h3 { margin: 0; font-size: 1.1rem; color: var(--primary-color); }
.card-header .icon { margin-right: 10px; font-size: 1.2rem; }
.card-content { display: none; padding-top: 15px; border-top: 1px solid #f0f0f0; margin-top: 10px; }
.card-content.open { display: block; }

.info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 0.95rem; }
.info-row:last-child { border: none; }
.major-info { background: #fff8f0; padding: 10px; border-radius: 8px; margin-bottom: 8px; font-weight: bold; }
.red-text { color: #c0392b; }
.note-text { font-size: 0.85rem; color: var(--text-light); margin-top: 5px; font-style: italic; }

/* è¡Œç¨‹æ¨£å¼ */
.day-card { background: white; border-radius: var(--border-radius); margin-bottom: 12px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
.day-header { padding: 15px; background: white; display: flex; align-items: center; cursor: pointer; transition: background 0.2s; }
.day-header.active { background: #f0f8ff; border-bottom: 1px solid #e1e8ed; }
.day-date-box { background: var(--primary-color); color: white; border-radius: 8px; padding: 5px 10px; text-align: center; margin-right: 15px; min-width: 60px; }
.day-date-box .date { font-size: 0.8rem; font-weight: bold; display: block; }
.day-date-box .weekday { font-size: 0.9rem; font-weight: bold; }
.day-title-box { flex: 1; }
.day-title-box h4 { margin: 0; font-size: 1.05rem; color: var(--text-main); }
.day-title-box span { font-size: 0.85rem; color: var(--text-light); }
.day-toggle-icon { font-size: 1.2rem; color: #ccc; transition: transform 0.3s; }
.day-header.active .day-toggle-icon { transform: rotate(180deg); color: var(--accent-color); }
.day-body { display: none; padding: 15px 15px 15px 10px; background: #fff; }
.day-body.open { display: block; animation: slideDown 0.3s ease-out; }
@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

.timeline { position: relative; padding-left: 20px; }
.timeline::before { content: ''; position: absolute; left: 6px; top: 5px; bottom: 5px; width: 2px; background: #eee; }
.event { position: relative; padding-left: 20px; margin-bottom: 25px; }
.event:last-child { margin-bottom: 0; }
.event-dot { position: absolute; left: -21px; top: 2px; width: 14px; height: 14px; background: white; border: 3px solid #ccc; border-radius: 50%; z-index: 2; }
.type-move .event-dot { border-color: #95a5a6; }
.type-spot .event-dot { border-color: #27ae60; }
.type-hotel .event-dot { border-color: #8e44ad; }
.type-food .event-dot { border-color: #d35400; }
.event-time { font-size: 0.85rem; font-weight: bold; color: var(--accent-color); margin-bottom: 2px; display: flex; align-items: center; }
.event-tag { font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; background: #eee; color: #666; margin-left: 8px; font-weight: normal; }
.event-content h5 { margin: 0 0 4px 0; font-size: 1rem; color: var(--text-main); }
.event-desc { font-size: 0.9rem; color: #666; line-height: 1.4; margin-bottom: 6px; }

/* æœå°‹é€£çµæ¨£å¼ (å–ä»£æŒ‰éˆ•) */
.search-link {
    color: var(--text-main);
    text-decoration: underline;
    text-decoration-color: var(--accent-color);
    text-decoration-thickness: 2px;
    text-underline-offset: 3px;
    cursor: pointer;
    transition: color 0.2s;
}
.search-link:active { color: var(--accent-color); background-color: rgba(41, 128, 185, 0.1); }

/* æ—¥èªå¡ç‰‡æ¨£å¼ */
.jp-category { margin-bottom: 20px; }
.jp-header { font-weight: bold; color: var(--primary-color); padding: 8px 5px; border-bottom: 2px solid #eee; margin-bottom: 10px; display: flex; align-items: center; }
.jp-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
.jp-card {
    background: white; border-radius: 8px; padding: 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #eee;
    display: flex; justify-content: space-between; align-items: center;
    cursor: pointer; transition: transform 0.1s, background 0.1s;
    -webkit-tap-highlight-color: rgba(0,0,0,0.05);
}
.jp-card:active { transform: scale(0.98); background: #f0f8ff; border-color: var(--accent-color); }
.jp-text { flex: 1; }
.jp-word { font-size: 1.1rem; font-weight: bold; color: #333; display: block; margin-bottom: 2px; }
.jp-romaji { font-size: 0.8rem; color: #888; font-family: monospace; display: block; margin-bottom: 2px; }
.jp-cn { font-size: 0.9rem; color: var(--accent-color); }
.jp-icon { font-size: 1.2rem; opacity: 0.3; }

.hotel-card { display: flex; flex-direction: column; overflow: hidden; }
.hotel-info { padding: 15px; }
.hotel-actions { display: flex; border-top: 1px solid #eee; }
.action-btn { flex: 1; padding: 12px; text-align: center; color: var(--accent-color); text-decoration: none; border-right: 1px solid #eee; background: #f9f9f9; }
.action-btn:last-child { border-right: none; }

.check-item { display: flex; padding: 12px 0; border-bottom: 1px solid #eee; }
.check-item input { width: 22px; height: 22px; margin-right: 12px; margin-top: 2px; }
.check-item label { flex: 1; font-size: 1rem; }
.checklist-progress { display: flex; align-items: center; margin-bottom: 15px; background: #f0f2f5; padding: 10px; border-radius: 8px; }
.progress-bar { flex: 1; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden; margin-right: 10px; }
.progress-fill { height: 100%; background: #27ae60; transition: width 0.3s; }
.btn-reset { width: 100%; padding: 10px; background: #95a5a6; color: white; border: none; border-radius: 8px; margin-top: 10px; font-size: 0.9rem; }

.bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; height: calc(var(--nav-height) + var(--safe-bottom)); padding-bottom: var(--safe-bottom); z-index: 1000; }
.nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #bdc3c7; font-size: 0.7rem; }
.nav-item.active { color: var(--primary-color); }
.nav-item .icon { font-size: 1.4rem; margin-bottom: 3px; }

.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
.modal.open { display: flex; }
.modal-content { background: white; width: 100%; max-width: 320px; border-radius: 16px; padding: 20px; animation: slideUp 0.3s; position: relative; }
.close-btn { position: absolute; right: 15px; top: 10px; font-size: 24px; cursor: pointer; color: #999; }
.contact-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; text-decoration: none; color: inherit; }
.contact-info .name { font-weight: bold; display: block; }
.contact-info .role { font-size: 0.8rem; color: #888; }
.phone-icon { background: #eef6fb; color: var(--accent-color); padding: 5px 10px; border-radius: 15px; font-size: 0.9rem; }
.divider { border-bottom: 1px solid #eee; margin: 5px 0; }

</style>
</head>
<body>

    <header class="app-header">
        <div class="header-content">
            <h1>ä¹å·å››åœ‹åœ°è³ªè€ƒå¯Ÿ</h1>
            <p>NTNU & Kyushu Univ. Joint Field Trip</p>
        </div>
        <button id="emergency-btn" class="icon-btn pulse-animation" onclick="toggleModal('emergency-modal')">ğŸ†˜</button>
    </header>

    <main id="main-container">
        
        <section id="view-home" class="view active">
            
            <div class="card highlight-card">
                <div class="card-header">
                    <span class="icon">ğŸš©</span> 
                    <h3>é›†åˆè³‡è¨Š (Meeting)</h3>
                </div>
                <div class="card-body">
                    <div class="info-row major-info">
                        <span class="label">æ™‚é–“</span>
                        <span class="value red-text">1/13 (äºŒ) AM 05:50</span>
                    </div>
                    <div class="info-row">
                        <span class="label">åœ°é»</span>
                        <span class="value">æ¡ƒåœ’æ©Ÿå ´ T2 3F å‡ºå¢ƒå¤§å»³</span>
                    </div>
                    <div class="info-row">
                        <span class="label">æ«ƒå°</span>
                        <span class="value">é•·æ¦®èˆªç©º 14/15 è™Ÿæ«ƒå°å‰æ–¹</span>
                    </div>
                    <p class="note-text">âš ï¸ å‹™å¿…æ–¼èµ·é£›å‰ 2 å°æ™‚æŠµé”</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="icon">âœˆï¸</span>
                    <h3>èˆªç­è³‡è¨Š (Flights)</h3>
                </div>
                <div class="card-body flight-grid">
                    <div class="flight-leg">
                        <div class="flight-badge go">å»ç¨‹ 1/13</div>
                        <div class="flight-route">
                            <span class="city">TPE</span> 08:00 â <span class="city">FUK</span> 11:15
                        </div>
                        <div class="flight-detail">é•·æ¦® BR106 (T2) | 2hr 15m</div>
                    </div>
                    <div class="divider"></div>
                    <div class="flight-leg">
                        <div class="flight-badge return">å›ç¨‹ 1/19</div>
                        <div class="flight-route">
                            <span class="city">KIX</span> 18:10 â <span class="city">TPE</span> 20:25
                        </div>
                        <div class="flight-detail">é•·æ¦® BR129 (T1å‡ºç™¼) | 3hr 15m</div>
                    </div>
                    <div class="info-footer">
                        æ‰˜é‹ï¼š23kg (å»1ä»¶/å›2ä»¶) | æ‰‹æï¼š7kg
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="icon">ğŸ“¢</span>
                    <h3>é‡è¦é ˆçŸ¥</h3>
                </div>
                <div class="card-body">
                    <ul class="bullet-list">
                        <li><strong>è£œåŠ©é‡‘ï¼š</strong>æŠµé”æ—¥æœ¬å¾Œç™¼æ”¾ Â¥10,000/äºº (ç”¨æ–¼é¤è²»èˆ‡åœ°éµ)ã€‚</li>
                        <li><strong>æ™‚å·®ï¼š</strong>æ—¥æœ¬æ¯”å°ç£å¿« 1 å°æ™‚ï¼Œé›†åˆä»¥æ—¥æœ¬æ™‚é–“ç‚ºæº–ã€‚</li>
                        <li><strong>åš´ç¦è„«éšŠï¼š</strong>åœ˜é«”è¡Œå‹•ï¼Œä¿éšœå®‰å…¨ã€‚</li>
                        <li><strong>é¤è²»é ä¼°ï¼š</strong>æ—©Â¥500 / åˆÂ¥1000 / æ™šÂ¥1500ã€‚</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="view-schedule" class="view">
            <div class="section-title">æ¯æ—¥è¡Œç¨‹ (é»æ“Šå±•é–‹)</div>
            <p class="note-text" style="padding: 0 5px 10px 5px;">ğŸ’¡ é»æ“Šæœ‰åº•ç·šçš„æ¨™é¡Œå¯ç›´æ¥ Google æœå°‹åœ°é»ã€‚</p>
            <div id="schedule-container" class="accordion-container"></div>
        </section>

        <section id="view-hotels" class="view">
            <div class="section-title">ä½å®¿è³‡è¨Š</div>
            <div id="hotel-container"></div>
        </section>

        <section id="view-japanese" class="view">
            <div class="section-title">å¸¸ç”¨æ—¥èª (é»æ“Šç™¼éŸ³)</div>
            <div id="japanese-container"></div>
        </section>

        <section id="view-info" class="view">
            
            <div class="card">
                <div class="card-header clickable-header" onclick="toggleCardContent('checklist-content')">
                    <h3>ğŸ’ è£å‚™æª¢æŸ¥ (Checklist)</h3>
                    <span class="arrow-icon">â–¼</span>
                </div>
                <div id="checklist-content" class="card-content open">
                    <div class="checklist-progress">
                        <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
                        <span id="progress-text">0%</span>
                    </div>
                    <div id="checklist-container"></div>
                    <button class="btn-reset" onclick="resetChecklist()">é‡ç½®æ¸…å–®</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header clickable-header" onclick="toggleCardContent('notes-content')">
                    <h3>âš ï¸ è©³ç´°æ³¨æ„äº‹é …</h3>
                    <span class="arrow-icon">â–¼</span>
                </div>
                <div id="notes-content" class="card-content">
                    <ol class="ordered-list" id="notes-list"></ol>
                </div>
            </div>
        </section>
    </main>

    <div id="emergency-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="toggleModal('emergency-modal')">Ã—</span>
            <h2>ğŸ“ ç·Šæ€¥è¯çµ¡äºº</h2>
            <div class="contact-list">
                <a href="tel:0920995210" class="contact-item">
                    <div class="contact-info">
                        <span class="name">è³´æ˜±éŠ˜ è€å¸« (Prof. Lai)</span>
                    </div>
                    <span class="phone-icon">0920-995210</span>
                </a>
                <a href="tel:0910043753" class="contact-item">
                    <div class="contact-info">
                        <span class="name">è‘‰æ©è‚‡ è€å¸« (Prof. Yeh)</span>
                    </div>
                    <span class="phone-icon">0910-043753</span>
                </a>
                 <div class="divider"></div>
                <a href="tel:+88633983274" class="contact-item">
                    <div class="contact-info">
                        <span class="name">æ¡ƒåœ’æ©Ÿå ´ T2 å®¢æœ</span>
                    </div>
                    <span class="phone-icon">(03) 398-3274</span>
                </a>
                 <a href="https://www.boca.gov.tw/cp-87-212-68045-1.html" target="_blank" class="contact-item" style="background:#fff3cd">
                    <div class="contact-info">
                        <span class="name">æ—…å¤–åœ‹äººæ€¥é›£æ•‘åŠ©</span>
                        <span class="role">æ—¥æœ¬å¢ƒå…§ç›´æ’¥ 080-1-008855</span>
                    </div>
                    <span class="phone-icon">ğŸŒ</span>
                </a>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchView('home', this)">
            <span class="icon">ğŸ </span>
            <span class="label">é¦–é </span>
        </div>
        <div class="nav-item" onclick="switchView('schedule', this)">
            <span class="icon">ğŸ“…</span>
            <span class="label">è¡Œç¨‹</span>
        </div>
        <div class="nav-item" onclick="switchView('japanese', this)">
            <span class="icon">ğŸ—£ï¸</span>
            <span class="label">æ—¥èª</span>
        </div>
        <div class="nav-item" onclick="switchView('hotels', this)">
            <span class="icon">ğŸ¨</span>
            <span class="label">ä½å®¿</span>
        </div>
        <div class="nav-item" onclick="switchView('info', this)">
            <span class="icon">ğŸ’</span>
            <span class="label">æº–å‚™</span>
        </div>
    </nav>

    <script>
		
// --- è³‡æ–™ä¾†æº ---

const tripData = {
    // è¡Œç¨‹è³‡æ–™
    schedule: [
        {
            date: "1/13", day: "Tue", title: "æŠµé”ç¦å²¡ & æ­¡è¿æœƒ",
            events: [
                { time: "05:50", title: "æ©Ÿå ´é›†åˆ", desc: "æ¡ƒåœ’æ©Ÿå ´ T2 3F (é•·æ¦® 14/15 æ«ƒå°å‰)\nâš ï¸ å‹™å¿…æº–æ™‚", type: "move" },
                { time: "08:00", title: "ç­æ©Ÿèµ·é£› BR106", desc: "TPE âœˆï¸ FUK (11:15 æŠµé”)", type: "move" },
                { time: "12:00", title: "å‰å¾€ç³¸å³¶å¸‚", desc: "", type: "move", q: "ç³¸å³¶å¸‚" },
                { time: "13:00", title: "é£¯åº— Check-in", desc: "AZ Hotel Itoshima", type: "hotel", q: "AZ Hotel Itoshima" },
                { time: "14:30", title: "åƒè¨ªä¹å·å¤§å­¸", desc: "ä¼Šéƒ½æ ¡å€ Campus Tour", type: "work", q: "ä¹å·å¤§å­¸ ä¼Šéƒ½æ ¡å€" },
                { time: "18:00", title: "Welcome Party", desc: "Contigo ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³(èŠ¥å±‹)", type: "food", q: "Contigo ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ èŠ¥å±‹" }
            ]
        },
        {
            date: "1/14", day: "Wed", title: "æ´¥å±‹å´ - èŠ¦å±‹ - ç›´æ–¹å¸‚",
            events: [
                { time: "08:00", title: "å‡ºç™¼", desc: "é£¯åº—å‡ºç™¼", type: "move" },
                { time: "10:20", title: "Stop 1-1 æ´¥å±‹å´", desc: "å§‹æ–°ä¸–é™¸æˆå±¤ / ç«ç •æµå †ç©ç‰©", type: "spot", q: "æ´¥å±‹å´æµ·å²¸" },
                { time: "12:30", title: "Stop 1-2 èŠ¦å±‹ (å¤äº•ãŒæµœ)", desc: "æ¼¸æ–°ä¸–ã‚¹ãƒˆãƒ¼ãƒ å †ç©å±¤", type: "spot", q: "å¤äº•ãƒ¶æµœã¯ã¾ã‚†ã†å…¬åœ’" },
                { time: "13:30", title: "Stop 1-3 ç›´æ–¹çŸ³ç‚­åšç‰©é¤¨", desc: "åƒè§€åšç‰©é¤¨", type: "spot", q: "ç›´æ–¹å¸‚çŸ³ç‚­è¨˜å¿µé¤¨" },
                { time: "18:30", title: "ä½å®¿ Check-in", desc: "ä¸ƒåŸæ¸©æ³‰ Riverside Park", type: "hotel", q: "ä¸ƒåŸæ¸©æ³‰ãƒ‰ãƒ¼ãƒ " },
                { time: "18:30", title: "æ™šé¤ BBQ", desc: "Yakiniku and Hot spring", type: "food" }
            ]
        },
        {
            date: "1/15", day: "Thu", title: "é˜¿è˜‡ç«å±± & ç†Šæœ¬åœ°éœ‡",
            events: [
                { time: "10:00", title: "Stop 2-1 ç†Šæœ¬åœ°éœ‡ç´€å¿µé¤¨", desc: "KIOKU éœ‡ç½ãƒŸãƒ¥ãƒ¼ã‚¸ã‚¢ãƒ ", type: "spot", q: "ç†Šæœ¬åœ°éœ‡éœ‡ç½ãƒŸãƒ¥ãƒ¼ã‚¸ã‚¢ãƒ  KIOKU" },
                { time: "11:10", title: "Stop 2-2 å¤–è¼ªå±±å£æ‘æœ¬æ¡çŸ³å ´", desc: "", type: "spot" },
                { time: "12:10", title: "Stop 2-3 å¤–è¼ªå±±(å…œå²©å±•æœ›å°)", desc: "çœºæœ›é˜¿è˜‡äº”å²³", type: "spot", q: "å…œå²©å±•æœ›æ‰€" },
                { time: "12:30", title: "Stop 2-4 ãƒ©ãƒ”ãƒ¥ã‚¿ã®é“", desc: "å¤©ç©ºä¹‹é“", type: "spot", q: "ãƒ©ãƒ”ãƒ¥ã‚¿ã®é“" },
                { time: "14:00", title: "Stop 2-5 é˜¿è˜‡å±±é ‚", desc: "ä¸­å²³ç«å£å±•æœ›å° ç ‚åƒé‡Œ\nâš ï¸ è‹¥é‡é›¨å¤©æ”¹å»ã€Œé¯›ç”Ÿé‡‘å±±ã€(+Â¥900)", type: "spot", q: "é˜¿è˜‡ä¸­å²³ç«å£" },
                { time: "15:00", title: "Stop 2-6 é˜¿è˜‡ç«å±±åšç‰©é¤¨", desc: "è‰åƒé‡Œå‰", type: "spot", q: "é˜¿è˜‡ç«å±±åšç‰©é¤¨" },
                { time: "16:30", title: "é˜¿è˜‡æ—¥ã®å±±æ¸©æ³‰", desc: "ã©ã‚“ã©ã“æ¹¯ (è²»ç”¨600å††)", type: "spot", q: "ã©ã‚“ã©ã“æ¹¯" },
                { time: "18:30", title: "ä½å®¿ Check-in", desc: "Farm Village ç”¢å±±", type: "hotel", q: "ãƒ•ã‚¡ãƒ¼ãƒ ãƒ“ãƒ¬ãƒƒã‚¸ç”£å±±" }
            ]
        },
        {
            date: "1/16", day: "Fri", title: "å·¨å¤§ç«ç •æµ & è®Šè³ªå²©",
            events: [
                { time: "09:30", title: "Stop 3-1 ç«¹ç”°å¸‚ é‡é¹¿æ´ç©´", desc: "é˜¿è˜‡4ç«ç •æµ", type: "spot", q: "ç«¹ç”°å¸‚ é‡é¹¿æ´ç©´" },
                { time: "11:00", title: "Stop 3-2 åŸå°»ã®æ»", desc: "æ±æ´‹çš„å°¼åŠ æ‹‰ç“œç€‘å¸ƒ", type: "spot", q: "åŸå°»ã®æ»" },
                { time: "14:10", title: "Stop 3-3 å¤§åˆ†å¸‚ä½è³€é–¢", desc: "ä¸‰æ³¢å·å¤‰æˆå²©é¡", type: "spot", q: "é–¢å´æµ·æ˜Ÿé¤¨" },
                { time: "16:00", title: "æ­ä¹˜æ¸¡è¼ª", desc: "å›½é“ä¹å››ãƒ•ã‚§ãƒªãƒ¼ (ä½è³€é–¢ -> ä¸‰å´)\nè¨˜å¾—åƒæšˆè»Šè—¥", type: "move", q: "å›½é“ä¹å››ãƒ•ã‚§ãƒªãƒ¼" },
                { time: "18:30", title: "ä½å®¿ Check-in", desc: "å›½ç«‹å¤§æ´²é’å°‘å¹´äº¤æµã®å®¶", type: "hotel", q: "å›½ç«‹å¤§æ´²é’å°‘å¹´äº¤æµã®å®¶" }
            ]
        },
        {
            date: "1/17", day: "Sat", title: "ä¸­å¤®æ§‹é€ ç·š (MTL)",
            events: [
                { time: "09:30", title: "Stop 4-1 ç ¥éƒ¨ç„¼ã", desc: "ç ¥éƒ¨è¡ä¸Šæ–­å±¤", type: "spot", q: "ç ¥éƒ¨è¡ä¸Šæ–­å±¤å…¬åœ’" },
                { time: "13:00", title: "Stop 4-2 ä¸­å±±å·", desc: "æ¹¯è°·å£è¡ä¸Šæ–­å±¤", type: "spot" },
                { time: "14:20", title: "Stop 4-3 åˆ¥å­éŠ…å±±è¨˜å¿µé¤¨", desc: "åƒè§€", type: "spot", q: "åˆ¥å­éŠ…å±±è¨˜å¿µé¤¨" },
                { time: "16:30", title: "Stop 4-4 é“ã®é§…ã¿ã‚ˆã—", desc: "ä¸­å¤®æ§‹é€ ç·šéœ²é ­", type: "spot", q: "ä¸­å¤®æ§‹é€ ç·š éœ²é ­ ä¸‰å¥½" },
                { time: "18:30", title: "ä½å®¿ Check-in", desc: "ã‚„ã¾ã³ã“äº¤æµã‚»ãƒ³ã‚¿ãƒ¼ (é¦™å·)", type: "hotel", q: "æ±ã‹ãŒã‚å¸‚ ã‚„ã¾ã³ã“äº¤æµã‚»ãƒ³ã‚¿ãƒ¼" }
            ]
        },
        {
            date: "1/18", day: "Sun", title: "å’Œæ³‰å±¤ç¾¤ & é³´é–€",
            events: [
                { time: "09:00", title: "Stop 5-1 ç™½é³¥", desc: "é¹¿æµ¦è¶Šã®ãƒ©ãƒ³ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ¤å²©è„ˆ", type: "spot", q: "é¹¿æµ¦è¶Š ãƒ©ãƒ³ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ã‚¢å²©è„ˆ" },
                { time: "09:40", title: "Stop 5-2 å’Œæ³‰å±¤ç¾¤ä¸æ•´åˆ", desc: "å´–ä¸‹ã‚Š (Option)", type: "spot" },
                { time: "11:00", title: "Stop 5-3 å¾³å³¶çœŒç«‹åšç‰©é¤¨", desc: "åˆé¤èˆ‡åƒè§€", type: "spot", q: "å¾³å³¶çœŒç«‹åšç‰©é¤¨" },
                { time: "14:30", title: "Stop 5-4 å¤§ç¥å­æµ·å²¸éŠæ­¥é“", desc: "ä¸‰æ³¢å·å¤‰æˆå²©", type: "spot", q: "å¤§ç¥å­æµ·å²¸" },
                { time: "16:30", title: "Stop 5-5 å³¶ç”°å³¶ (Option)", desc: "å¦‚æœ‰æ™‚é–“å‰å¾€", type: "spot" },
                { time: "18:30", title: "è¿”å›ä½å®¿", desc: "ã‚„ã¾ã³ã“äº¤æµã‚»ãƒ³ã‚¿ãƒ¼ (é€£æ³Š)", type: "hotel" }
            ]
        },
        {
            date: "1/19", day: "Mon", title: "æ·¡è·¯å³¶ & è¿”å°",
            events: [
                { time: "09:40", title: "Stop 6-1 æ·¡è·¯å³¶", desc: "åŒ—æ·¡éœ‡ç½è¨˜å¿µé¤¨ / é‡å³¶æ–­å±¤ä¿å­˜é¤¨", type: "spot", q: "åŒ—æ·¡éœ‡ç½è¨˜å¿µé¤¨" },
                { time: "11:30", title: "Stop 6-2 é˜ªç¥æ·¡è·¯å¤§éœ‡ç½è¨˜å¿µ", desc: "äººã¨é˜²ç½æœªæ¥ã‚»ãƒ³ã‚¿ãƒ¼", type: "spot", q: "äººã¨é˜²ç½æœªæ¥ã‚»ãƒ³ã‚¿ãƒ¼" },
                { time: "12:30", title: "ç¥æˆ¶ Harborland", desc: "è³¼ç‰©è§€å…‰ (è‹¥æœ‰æ™‚é–“)", type: "spot", q: "Kobe Harborland" },
                { time: "16:30", title: "å‰å¾€é—œè¥¿æ©Ÿå ´ (KIX)", desc: "é•·æ¦®æ«ƒå° Check-in", type: "move" },
                { time: "18:10", title: "ç­æ©Ÿèµ·é£› BR129", desc: "KIX âœˆï¸ TPE (20:25 æŠµé”)", type: "move" }
            ]
        }
    ],
    // ä½å®¿è³‡æ–™
    hotels: [
        { date: "1/13", name: "AZ HOTEL ITOSHIMA", address: "ç¦å²¡çœŒç³¸å³¶å¸‚æµ¦å¿—1ä¸ç›®9-25", tel: "+81-923-30-8301" },
        { date: "1/14", name: "ä¸ƒåŸæ¸©æ³‰ Riverside park", address: "ç†Šæœ¬çœŒèŠæ± å¸‚ä¸ƒåŸç”ºæ—åŸ962-1", tel: "+81-968-26-4800" },
        { date: "1/15", name: "Farm Village ç”¢å±±", address: "ç†Šæœ¬çœŒé˜¿è˜‡éƒ¡ç”£å±±æ‘å¤§åˆ©585", tel: "+81-967-25-2900" },
        { date: "1/16", name: "å›½ç«‹å¤§æ´²é’å°‘å¹´äº¤æµã®å®¶", address: "æ„›åª›çœŒå¤§æ´²å¸‚åŒ—åª108-6", tel: "+81-893-24-5175" },
        { date: "1/17-18", name: "ã‚„ã¾ã³ã“äº¤æµã‚»ãƒ³ã‚¿ãƒ¼", address: "é¦™å·çœŒæ±ã‹ãŒã‚å¸‚ä¸ç”°å±±351-1", tel: "+81-879-27-2460" }
    ],
    // æ—¥èªè³‡æ–™ (å«ç™¼éŸ³æ–‡å­—ã€ç¾…é¦¬æ‹¼éŸ³ã€ä¸­æ–‡)
    japanesePhrases: [
        {
            category: "ğŸ‘‹ å•å€™èˆ‡ç¦®è²Œ",
            list: [
                { jp: "ã“ã‚“ã«ã¡ã¯", ro: "Konnichiwa", cn: "ä½ å¥½ (ç™½å¤©)" },
                { jp: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", ro: "Arigatou gozaimasu", cn: "è¬è¬" },
                { jp: "ã™ã¿ã¾ã›ã‚“", ro: "Sumimasen", cn: "ä¸å¥½æ„æ€ / è«‹å•" },
                { jp: "ã¯ã„ / ã„ã„ãˆ", ro: "Hai / Iie", cn: "æ˜¯ / ä¸æ˜¯" },
                { jp: "ãŠã­ãŒã„ã—ã¾ã™", ro: "Onegaishimasu", cn: "æ‹œè¨—äº† / éº»ç…©ä½ " }
            ]
        },
        {
            category: "ğŸ›’ è³¼ç‰©èˆ‡çµå¸³",
            list: [
                { jp: "ã“ã‚Œ", ro: "Kore", cn: "é€™å€‹" },
                { jp: "ã„ãã‚‰ã§ã™ã‹", ro: "Ikura desuka", cn: "å¤šå°‘éŒ¢ï¼Ÿ" },
                { jp: "ã‚«ãƒ¼ãƒ‰ã¯ä½¿ãˆã¾ã™ã‹", ro: "Kaado wa tsukaemasuka", cn: "å¯ä»¥ç”¨ä¿¡ç”¨å¡å—ï¼Ÿ" },
                { jp: "è¢‹ã¯ã„ã‚Šã¾ã›ã‚“", ro: "Fukuro wa irimasen", cn: "ä¸ç”¨è¢‹å­" },
                { jp: "é ˜åæ›¸ãã ã•ã„", ro: "Ryoushuusho kudasai", cn: "è«‹çµ¦æˆ‘æ”¶æ“š" }
            ]
        },
        {
            category: "ğŸ½ï¸ é¤å»³ç”¨é¤",
            list: [
                { jp: "ãŠæ°´ãã ã•ã„", ro: "Omizu kudasai", cn: "è«‹çµ¦æˆ‘æ°´" },
                { jp: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹", ro: "Toire wa doko desuka", cn: "å»æ‰€åœ¨å“ªè£¡ï¼Ÿ" },
                { jp: "ãŠã„ã—ã„ã§ã™", ro: "Oishii desu", cn: "å¾ˆå¥½åƒ" },
                { jp: "ãŠä¼šè¨ˆãŠã­ãŒã„ã—ã¾ã™", ro: "Okaikei onegaishimasu", cn: "éº»ç…©çµå¸³" },
                { jp: "ã”ã¡ãã†ã•ã¾ã§ã—ãŸ", ro: "Gochisousama deshita", cn: "è¬è¬æ‹›å¾… (åƒé£½å¾Œ)" }
            ]
        },
        {
            category: "ğŸšŒ äº¤é€š",
            list: [
                { jp: "é§…ã¯ã©ã“ã§ã™ã‹", ro: "Eki wa doko desuka", cn: "è»Šç«™åœ¨å“ªè£¡ï¼Ÿ" },
                { jp: "ãƒã‚¹åœ", ro: "Basutei", cn: "å…¬è»Šç«™" },
                { jp: "åˆ‡ç¬¦", ro: "Kippu", cn: "è»Šç¥¨" },
                { jp: "ã“ã“ã«è¡ŒããŸã„ã§ã™", ro: "Koko ni ikitai desu", cn: "æˆ‘æƒ³å»é€™è£¡ (æŒ‡åœ°åœ–)" }
            ]
        },
        {
            category: "ğŸ†˜ ç·Šæ€¥ç‹€æ³",
            list: [
                { jp: "åŠ©ã‘ã¦", ro: "Tasukete", cn: "æ•‘å‘½ / å¹«å¹«æˆ‘" },
                { jp: "è­¦å¯Ÿ", ro: "Keisatsu", cn: "è­¦å¯Ÿ" },
                { jp: "ç—…é™¢", ro: "Byouin", cn: "é†«é™¢" },
                { jp: "æ°—åˆ†ãŒæ‚ªã„ã§ã™", ro: "Kibun ga warui desu", cn: "æˆ‘ä¸èˆ’æœ" }
            ]
        }
    ],
    // æ¸…å–®è³‡æ–™
    checklistItems: [
        "è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)",
        "ç·Šæ€¥è¯çµ¡é›»è©±è³‡è¨Š",
        "é‡è¦æ–‡ä»¶å½±æœ¬",
        "èº«ä»½è­‰æ˜æ–‡ä»¶",
        "è­‰ä»¶ç…§2å¼µ (å‚™ç”¨)",
        "å°‘é‡å¤–å¹£åŠå°å¹£",
        "å…§è¡£è¤²",
        "è¥ªå­",
        "å¤–è¡£/å¤–è¤²",
        "å¤–å¥— (é˜²é¢¨ä¿æš–)",
        "æ¯›å·¾ (éƒ¨åˆ†æ—…é¤¨ä¸å«)",
        "ç‰™åˆ·/ç‰™è†",
        "æ²æµ´ä¹³/æ´—é¢ä¹³",
        "æ´—é«®ç²¾/æ½¤é«®ä¹³",
        "æ¢³å­",
        "ç›¸æ©Ÿ",
        "ç›¸æ©Ÿé›»æ± /å……é›»å™¨",
        "è¨˜æ†¶å¡",
        "æ‰‹æ©Ÿ",
        "æ‰‹æ©Ÿé€£æ¥ç·š/å……é›»å™¨",
        "è¡Œå‹•é›»æº",
        "å…¶ä»–ç”¨å“å……é›»å™¨",
        "é›»è…¦/é›»æºç·š",
        "ç¶²è·¯:WIFIæ©Ÿ/SIMå¡",
        "å‚™ç”¨çœ¼é¡",
        "é¤å…·(æ¹¯åŒ™/ç­·å­/å‰å­/å¸ç®¡)",
        "å¡‘è† è¢‹(å¤§+å°)",
        "è¡›ç”Ÿç´™/æº¼ç´™å·¾",
        "è¡Œæè¢‹/å‚™ç”¨èƒŒåŒ…",
        "æ³³è¡£/(æ³³é¡/æ³³å¸½)",
        "é˜²æ›¬æ²¹",
        "é˜²æ›¬ç”¨å“(å¤–å¥—/è¢–å¥—/å¸½å­)",
        "ç™»å±±é‹/å¥èµ°é‹",
        "é›¨å…·(é›¨è¡£/é›¨å‚˜)",
        "æšˆè»Šè—¥",
        "è…¸èƒƒè—¥",
        "å€‹äººè—¥å“ (å¸¸å‚™è—¥)",
        "éæ•è—¥",
        "å¤–å‚·ç”¨è—¥",
        "åœ°è³ªåœ–/è·¯ç·šåœ–/åœ°åœ–",
        "æ”¾å¤§é¡",
        "å‚¾æ–œå„€",
        "æ‰‹å¥—",
        "ç­†/å½©è™¹ç­†/å¥‡ç•°ç­†",
        "é‡å¸³æœ¬/ç­†è¨˜æœ¬",
        "æ´—è¡£ç²‰/æ´—è¡£ç²¾"
    ],
    // æ³¨æ„äº‹é …
    notes: [
        "è«‹è¨˜ä½è€å¸«åŠåŠ©æ•™é›»è©±ï¼Œè‹¥æœ‰ç·Šæ€¥ç‹€æ³è«‹ç«‹å³è¯ç¹«ã€‚",
        "å‹™å¿…æ–¼èˆªç­èµ·é£›å‰ **2å°æ™‚** æŠµé”æŒ‡å®šåœ°é»é›†åˆã€‚",
        "æ‰˜é‹è¡Œæé™é‡ 23kg (å»ç¨‹1ä»¶ï¼Œå›ç¨‹2ä»¶)ï¼Œæ‰‹æ 7kgã€‚",
        "é‡å¤–èª²ç¨‹ä¸ä¿è­‰æ¯å®¶æ—…é¤¨éƒ½æœ‰ç›¥æ´—ç”¨å“ï¼Œè«‹å‹™å¿…è‡ªå‚™ã€‚",
        "è²´é‡ç‰©å“è«‹éš¨èº«æ”œå¸¶ï¼Œå‹¿æ”¾è»Šä¸Šæˆ–æˆ¿é–“ã€‚",
        "åš´ç¦è„«éšŠï¼Œè«‹éµå®ˆåœ˜é«”é›†åˆæ™‚é–“ (æ—¥æœ¬æ™‚é–“ç‚ºæº–)ã€‚",
        "æ—¥æœ¬æ™‚é–“æ¯”å°ç£å¿«ä¸€å°æ™‚ã€‚",
        "æ¡ƒåœ’æ©Ÿå ´å®¢æœ: T2 (03)398-3274ã€‚"
    ]
};

// ç¢ºä¿ DOM è¼‰å…¥å¾Œæ‰åŸ·è¡Œ
document.addEventListener('DOMContentLoaded', () => {
    try {
        initSchedule();
        initHotels();
        initJapanese(); // åˆå§‹åŒ–æ—¥èª
        initChecklist();
        initNotes();
        autoOpenCurrentDay();
        
        // ç¶å®šå°èˆªæŒ‰éˆ•
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const match = this.getAttribute('onclick').match(/'([^']+)'/);
                if (match && match[1]) switchView(match[1], this);
            });
        });
    } catch (e) {
        console.error("Initialization error:", e);
    }
});

// --- åŠŸèƒ½å‡½æ•¸ ---

function initSchedule() {
    const container = document.getElementById('schedule-container');
    if (!container) return;

    let html = '';

    tripData.schedule.forEach((day, index) => {
        let eventsHtml = `<div class="timeline">`;
        day.events.forEach(ev => {
            const descText = ev.desc ? ev.desc.replace(/\n/g, '<br>') : '';
            
            // è™•ç†æ¨™é¡Œï¼šå¦‚æœæœ‰æœå°‹é—œéµå­—ï¼ŒåŠ ä¸Šé€£çµæ¨£å¼ï¼›å¦å‰‡é¡¯ç¤ºç´”æ–‡å­—
            let titleHtml = `<h5>${ev.title}</h5>`;
            if (ev.q) {
                const url = 'https://www.google.com/search?q=' + encodeURIComponent(ev.q);
                titleHtml = `<h5><a href="${url}" target="_blank" class="search-link">${ev.title}</a></h5>`;
            }
            
            eventsHtml += `
                <div class="event type-${ev.type}">
                    <div class="event-dot"></div>
                    <div class="event-content">
                        <div class="event-time">${ev.time} <span class="event-tag">${getTypeName(ev.type)}</span></div>
                        ${titleHtml}
                        <div class="event-desc">${descText}</div>
                    </div>
                </div>
            `;
        });
        eventsHtml += `</div>`;

        html += `
            <div class="day-card" id="day-${index}">
                <div class="day-header" onclick="toggleDay(${index})">
                    <div class="day-date-box">
                        <span class="date">${day.date}</span>
                        <span class="weekday">${day.day}</span>
                    </div>
                    <div class="day-title-box">
                        <h4>${day.title}</h4>
                        <span>${day.events.length} å€‹è¡Œç¨‹é»</span>
                    </div>
                    <div class="day-toggle-icon">â–¼</div>
                </div>
                <div class="day-body">
                    ${eventsHtml}
                </div>
            </div>
        `;
    });
    container.innerHTML = html;
}

function initJapanese() {
    const container = document.getElementById('japanese-container');
    if (!container) return;

    let html = '';
    tripData.japanesePhrases.forEach(cat => {
        let listHtml = `<div class="jp-grid">`;
        cat.list.forEach(phrase => {
            // æ³¨æ„ï¼šonclick ä½¿ç”¨ playAudio å‡½æ•¸
            listHtml += `
                <div class="jp-card" onclick="playAudio('${phrase.jp}')">
                    <div class="jp-text">
                        <span class="jp-word">${phrase.jp}</span>
                        <span class="jp-romaji">${phrase.ro}</span>
                        <span class="jp-cn">${phrase.cn}</span>
                    </div>
                    <div class="jp-icon">ğŸ”Š</div>
                </div>
            `;
        });
        listHtml += `</div>`;

        html += `
            <div class="jp-category">
                <div class="jp-header">${cat.category}</div>
                ${listHtml}
            </div>
        `;
    });
    container.innerHTML = html;
}

// èªéŸ³æ’­æ”¾åŠŸèƒ½ (ä½¿ç”¨ç€è¦½å™¨å…§å»º Web Speech API)
window.playAudio = function(text) {
    if ('speechSynthesis' in window) {
        // å–æ¶ˆç•¶å‰æ­£åœ¨æ’­æ”¾çš„ï¼Œé¿å…é€£é»é‡ç–Š
        window.speechSynthesis.cancel();

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ja-JP'; // è¨­å®šç‚ºæ—¥èª
        utterance.rate = 0.9;     // èªé€Ÿç¨æ…¢ä¸€é»é»ï¼Œæ¯”è¼ƒæ¸…æ¥š
        window.speechSynthesis.speak(utterance);
    } else {
        alert("æ‚¨çš„è£ç½®ä¸æ”¯æ´ç™¼éŸ³åŠŸèƒ½");
    }
};

function getTypeName(type) {
    const map = { move: 'äº¤é€š', spot: 'è€ƒå¯Ÿ', hotel: 'ä½å®¿', food: 'ç”¨é¤', work: 'åƒè¨ª' };
    return map[type] || 'æ´»å‹•';
}

window.toggleDay = function(index) {
    const dayCard = document.getElementById(`day-${index}`);
    if (!dayCard) return;

    const header = dayCard.querySelector('.day-header');
    const body = dayCard.querySelector('.day-body');
    
    if (header.classList.contains('active')) {
        header.classList.remove('active');
        body.classList.remove('open');
    } else {
        header.classList.add('active');
        body.classList.add('open');
    }
};

function autoOpenCurrentDay() {
    if (window.toggleDay) window.toggleDay(0);
}

function initHotels() {
    const container = document.getElementById('hotel-container');
    if (!container) return;

    let html = '';
    tripData.hotels.forEach(h => {
        const mapUrl = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(h.address);
        const telUrl = 'tel:' + h.tel.replace(/[-+ ]/g, '');
        
        html += `
            <div class="card hotel-card">
                <div class="hotel-info">
                    <div style="color:#7f8c8d; font-size:0.85rem; margin-bottom:4px;">ğŸ“… ${h.date}</div>
                    <div style="font-weight:bold; font-size:1.1rem; color:#2c3e50; margin-bottom:8px;">${h.name}</div>
                    <div style="font-size:0.9rem; margin-bottom:4px;">ğŸ“ ${h.address}</div>
                    <div style="font-size:0.9rem;">ğŸ“ <a href="${telUrl}">${h.tel}</a></div>
                </div>
                <div class="hotel-actions">
                    <a href="${mapUrl}" target="_blank" class="action-btn">ğŸ—ºï¸ åœ°åœ–</a>
                    <a href="${telUrl}" class="action-btn">ğŸ“ æ’¥è™Ÿ</a>
                </div>
            </div>
        `;
    });
    container.innerHTML = html;
}

function initChecklist() {
    const container = document.getElementById('checklist-container');
    if (!container) return;

    let html = '';
    tripData.checklistItems.forEach((item, index) => {
        const id = index + 1;
        html += `
            <div class="check-item">
                <input type="checkbox" id="chk-${id}" onchange="updateProgress()">
                <label for="chk-${id}">${id}. ${item}</label>
            </div>
        `;
    });
    container.innerHTML = html;
    restoreChecklist();
}

function initNotes() {
    const list = document.getElementById('notes-list');
    if (!list) return;

    list.innerHTML = tripData.notes.map(n => {
        const formatted = n.replace(/\*\*(.*?)\*\*/g, '<b class="red-text">$1</b>');
        return `<li>${formatted}</li>`;
    }).join('');
}

window.switchView = function(viewId, btn) {
    document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
    const target = document.getElementById(`view-${viewId}`);
    if (target) target.classList.add('active');
    
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    if (btn) btn.classList.add('active');
    
    window.scrollTo(0, 0);
};

window.toggleCardContent = function(id) {
    const content = document.getElementById(id);
    if (!content) return;
    
    const header = content.previousElementSibling;
    const arrow = header.querySelector('.arrow-icon');
    
    if (content.classList.contains('open')) {
        content.classList.remove('open');
        if (arrow) arrow.innerText = 'â–¼';
    } else {
        content.classList.add('open');
        if (arrow) arrow.innerText = 'â–²';
    }
};

window.updateProgress = function() {
    const inputs = document.querySelectorAll('.check-item input');
    let checked = 0;
    inputs.forEach(input => {
        if (input.checked) {
            checked++;
            localStorage.setItem(input.id, 'true');
        } else {
            localStorage.removeItem(input.id);
        }
    });
    
    if (inputs.length === 0) return;

    const pct = Math.round((checked / inputs.length) * 100);
    const fill = document.getElementById('progress-fill');
    const text = document.getElementById('progress-text');
    
    if (fill) fill.style.width = `${pct}%`;
    if (text) text.innerText = `${pct}%`;
};

function restoreChecklist() {
    document.querySelectorAll('.check-item input').forEach(input => {
        if (localStorage.getItem(input.id) === 'true') input.checked = true;
    });
    window.updateProgress();
}

window.resetChecklist = function() {
    if (!confirm('ç¢ºå®šé‡ç½®æ‰€æœ‰å‹¾é¸é …ç›®ï¼Ÿ')) return;
    localStorage.clear();
    document.querySelectorAll('.check-item input').forEach(i => i.checked = false);
    window.updateProgress();
};

window.toggleModal = function(id) {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('open');
};

window.onclick = function(event) {
    const modal = document.getElementById('emergency-modal');
    if (event.target == modal) window.toggleModal('emergency-modal');
};
    </script>
</body>
</html>